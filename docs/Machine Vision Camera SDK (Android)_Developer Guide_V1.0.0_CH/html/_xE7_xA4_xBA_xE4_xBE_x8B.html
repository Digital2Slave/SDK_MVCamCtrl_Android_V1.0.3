<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>工业相机Android SDK开发指南V1.0.0（java）</title> 
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="custom-style.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
	<div style="overflow: hidden;">
		<div style="height: 57px;min-width: 1039px;background-size: auto 100%;background:url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABwgAAAABCAYAAADKO/rAAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAAABRSURBVFhH7dUxCoBADEXB5LK5/w1iIaLIrsgWNs50Sf/4WVUd8HOZGd1nCqMbGNMPrNMPrJv1cvz0A3OjfuwPvDPrxf7A7t7IlX7gmX74VsQGguw4S6+UnSYAAAAASUVORK5CYII=');">
			<img src="titleleft.png" style="float: left;"/>
			<img src="titleright.png" alt="" style="float: right;" />
		</div>
	</div>
<!-- 制作者 Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'搜索');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>声明</span></a></li>
      <li><a href="_xE7_xAE_x80_xE4_xBB_x8B.html"><span>简介</span></a></li>
      <li><a href="_xE6_x9B_xB4_xE6_x96_xB0_xE8_xAE_xB0_xE5_xBD_x95.html"><span>更新记录</span></a></li>
      <li><a href="_xE7_xBC_x96_xE7_xA8_x8B_xE5_xBC_x95_xE5_xAF_xBC.html"><span>编程引导</span></a></li>
      <li><a href="modules.html"><span>接口函数</span></a></li>
      <li><a href="annotated.html"><span>结构体</span></a></li>
      <li><a href="_xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE8_x8A_x82_xE7_x82_xB9_xE8_xA1_xA8.html"><span>相机参数节点表</span></a></li>
      <li><a href="examples.html"><span>示例</span></a></li>
      <li><a href="_xE7_x8A_xB6_xE6_x80_x81_xE7_xA0_x81_xE5_xAE_x9A_xE4_xB9_x89.html"><span>状态码定义</span></a></li>
      <li><a href="_xE5_xB8_xB8_xE8_xA7_x81_xE9_x97_xAE_xE9_xA2_x98.html"><span>常见问题</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="搜索" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="contents">
<div class="textblock"><p>示例程序</p>
<p>&#160;&#160;&#160;&#160;本章节主要罗列以下示例程序供参考： </p><table style="margin: 20px 0 0 40px;" border="0">
<tr>
<td><a class="el" href="_xE7_xA4_xBA_xE4_xBE_x8B.html#获取相机事件">EventActivity.java</a></td><td>获取相机事件 </td></tr>
<tr>
<td><a class="el" href="_xE7_xA4_xBA_xE4_xBE_x8B.html#获取BMP格式图像">GetBitmapActivity.java</a> </td><td>获取BMP格式图像 </td></tr>
<tr>
<td><a class="el" href="_xE7_xA4_xBA_xE4_xBE_x8B.html#获取相机图像">GrabImageActivity.java</a> </td><td>获取相机图像 </td></tr>
<tr>
<td><a class="el" href="_xE7_xA4_xBA_xE4_xBE_x8B.html#通过回调获取相机图像">GrabImageCallBackActivity.java</a> </td><td>通过回调获取相机图像 </td></tr>
<tr>
<td><a class="el" href="_xE7_xA4_xBA_xE4_xBE_x8B.html#多相机取流">GrabMultipleCameraActivity.java</a> </td><td>多相机取流 </td></tr>
<tr>
<td><a class="el" href="_xE7_xA4_xBA_xE4_xBE_x8B.html#图像处理">ImageProcessActivity.java</a> </td><td>图像处理 </td></tr>
<tr>
<td><a class="el" href="_xE7_xA4_xBA_xE4_xBE_x8B.html#相机重连">ReconnectActivity.java</a> </td><td>相机重连 </td></tr>
<tr>
<td><a class="el" href="_xE7_xA4_xBA_xE4_xBE_x8B.html#设置相机静态ip">SetIpActivity.java</a> </td><td>设置相机静态ip </td></tr>
<tr>
<td><a class="el" href="_xE7_xA4_xBA_xE4_xBE_x8B.html#设置相机参数">SetParamActivity.java</a> </td><td>设置相机参数 </td></tr>
<tr>
<td><a class="el" href="_xE7_xA4_xBA_xE4_xBE_x8B.html#触发模式获取相机图像">TriggerImageActivity.java</a> </td><td>触发模式获取相机图像 </td></tr>
<tr>
<td><a class="el" href="_xE7_xA4_xBA_xE4_xBE_x8B.html#触发模式下通过回调获取相机图像">TriggerImageCallActivity.java</a> </td><td>触发模式下通过回调获取相机图像 </td></tr>
</table>
<p><br />
 </p>
<h1><a class="anchor" id="获取相机事件"></a>
EventActivity.java</h1>
<p>获取相机事件</p>
<p>该示例程序说明了如何配置相机事件功能、如何注册事件回调以及如何在事件回调函数中处理获取到的事件信息。Event事件例如：ExposureEnd。 </p><div class="fragment"><div class="line"><span class="keyword">package </span>com.example.event;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.text.method.ScrollingMovementMethod;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.Button;</div><div class="line"><span class="keyword">import</span> android.widget.EditText;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.CameraManager;</div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.IMainView;</div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.LogView;</div><div class="line"><span class="keyword">import</span> com.jaredrummler.materialspinner.MaterialSpinner;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.CameraControlException;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.CameraEventCallBack;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControl;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControlDefines;</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> MvCameraControlWrapper.MvCameraControlDefines.MV_OK;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>EventActivity <span class="keyword">extends</span> AppCompatActivity implements IMainView {</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ArrayList&lt;MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a>&gt; deviceList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">private</span> MaterialSpinner spinner;</div><div class="line">    EditText logTv;</div><div class="line">    <span class="keywordtype">int</span> selectNum = 0;</div><div class="line">    Button closeDeviceBt;</div><div class="line">    Button openDeviceBt;</div><div class="line">    <span class="keyword">final</span> <span class="keywordtype">int</span> MV_TRIGGER_MODE_OFF = 0;           <span class="comment">// ch:关闭 | en:Off</span></div><div class="line">    <span class="keyword">final</span> <span class="keywordtype">int</span> MV_TRIGGER_MODE_ON = 1;            <span class="comment">// ch:打开 | en:ON</span></div><div class="line">    OpenDeviceThread openDeviceThread = <span class="keyword">null</span>;</div><div class="line">    CloseDeviceThread closeDeviceThread = <span class="keyword">null</span>;</div><div class="line">    MvCameraControlDefines.Handle handle = <span class="keyword">null</span>;</div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onCreate(Bundle savedInstanceState) {</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_event);</div><div class="line">        initView();</div><div class="line">        initListener();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initView() {</div><div class="line">        spinner = findViewById(R.id.spinner);</div><div class="line">        logTv = findViewById(R.id.logTv);</div><div class="line">        logTv.setMovementMethod(ScrollingMovementMethod.getInstance());</div><div class="line">        openDeviceBt = findViewById(R.id.openDeviceBt);</div><div class="line">        closeDeviceBt = findViewById(R.id.closeDeviceBt);</div><div class="line">        spinner.setOnItemSelectedListener(<span class="keyword">new</span> MaterialSpinner.OnItemSelectedListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onItemSelected(MaterialSpinner view, <span class="keywordtype">int</span> position, <span class="keywordtype">long</span> <span class="keywordtype">id</span>, Object item) {</div><div class="line">                selectNum = position;</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initListener() {</div><div class="line">        findViewById(R.id.enumDevicesBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                selectNum = 0;</div><div class="line">                deviceList.clear();</div><div class="line">                spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line"></div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    deviceList = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga2e162b1972c75982ff1c52e1c5d34a4e">MV_CC_EnumDevices</a>(MvCameraControlDefines. MV_USB_DEVICE | MvCameraControlDefines. MV_GIGE_DEVICE);<span class="comment">//cameraManager.enumDevice();</span></div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (deviceList != <span class="keyword">null</span>) {</div><div class="line">                    <span class="keywordtype">int</span> size = deviceList.size();</div><div class="line">                    <span class="keywordflow">if</span> (size &gt; 0) {</div><div class="line">                        List&lt;String&gt; deviceName = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++) {</div><div class="line">                            MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a> entity = deviceList.get(i);</div><div class="line">                            <span class="keywordflow">if</span> (entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines. MV_GIGE_DEVICE) {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a9e8dbdf67802699038b0421c0d311499">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a727f4f765547596fdca29f86a2406dc9">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a0a3a766f998932a02e10e0223b05801c">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#ac0d8c9621aa38cb936f906d981c6a31b">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            } <span class="keywordflow">else</span> {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#ac568233b448c639976fe3280fcc2d0d5">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aeecafd7f0254f5bad432f2323b202700">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#a6b9a01f50a786e68ab65f3ba33079d26">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aac5ebaab488a72e9a7dcb2a5818e33bc">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            }</div><div class="line"></div><div class="line">                        }</div><div class="line">                        spinner.setItems(deviceName);</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                    }</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Not enumerated to device&quot;</span>);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        findViewById(R.id.openDeviceBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                openDevice();</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        findViewById(R.id.closeDeviceBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                closeDevice();</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> showLog(<span class="keyword">final</span> String str) {</div><div class="line">        LogView.showLog(<span class="keyword">this</span>,logTv,str);</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateButton(<span class="keywordtype">int</span> state) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateImage(<span class="keywordtype">byte</span>[] data) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> toast(String <span class="keywordtype">string</span>) {</div><div class="line">        Toast.makeText(EventActivity.this, <span class="keywordtype">string</span>, Toast.LENGTH_SHORT).show();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> openDevice() {</div><div class="line">        <span class="keywordflow">if</span> (openDeviceThread == <span class="keyword">null</span>) {</div><div class="line">            openDeviceThread = <span class="keyword">new</span> OpenDeviceThread();</div><div class="line">            openDeviceThread.start();</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            <span class="keywordflow">if</span> (!openDeviceThread.isAlive()) {</div><div class="line">                openDeviceThread.start();</div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                showLog(<span class="stringliteral">&quot;Please try later&quot;</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> closeDevice() {</div><div class="line">        <span class="keywordflow">if</span> (closeDeviceThread == <span class="keyword">null</span>) {</div><div class="line">            closeDeviceThread = <span class="keyword">new</span> CloseDeviceThread();</div><div class="line">            closeDeviceThread.start();</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            <span class="keywordflow">if</span> (!closeDeviceThread.isAlive()) {</div><div class="line">                closeDeviceThread.start();</div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                showLog(<span class="stringliteral">&quot;Please try later&quot;</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">class </span>OpenDeviceThread <span class="keyword">extends</span> Thread {</div><div class="line">        @Override</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line"></div><div class="line">            super.run();</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (deviceList != <span class="keyword">null</span> &amp;&amp; deviceList.size() &gt; 0) {</div><div class="line"></div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    handle = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#gae94fdee0967a330a197b783c781e36fb">MV_CC_CreateHandle</a>(deviceList.get(selectNum));</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (handle == <span class="keyword">null</span>) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;CreateHandle fail! nRet&quot;</span>);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordtype">int</span> nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga4e982ac1afd05dec95710ac2adcb6c6a">MV_CC_OpenDevice</a>(handle);</div><div class="line">                <span class="keywordflow">if</span> (nRet != 0) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;OpenDevice fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (deviceList.get(selectNum).<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines. MV_GIGE_DEVICE) {</div><div class="line">                    <span class="keywordtype">int</span> nPacketSize = MvCameraControl. <a class="code" href="group___gig_e_xE6_x8E_xA5_xE5_x8F_xA3_xE5_x87_xBD_xE6_x95_xB0.html#ga86ef17ec299b0ff442a063132ced4e6b">MV_CC_GetOptimalPacketSize</a>(handle);</div><div class="line">                    <span class="keywordflow">if</span> (nPacketSize &gt; 0) {</div><div class="line">                        nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga8932770d409766b20cc6819b6d48733f">MV_CC_SetIntValue</a>(handle,<span class="stringliteral">&quot;GevSCPSPacketSize&quot;</span>, nPacketSize);</div><div class="line">                        <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                            showLog(<span class="stringliteral">&quot;Warning: Set Packet Size fail nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">                            <span class="keywordflow">return</span>;</div><div class="line">                        }</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        showLog(<span class="stringliteral">&quot;Warning: Get Packet Size fail nRet&quot;</span> + Integer.toHexString(nPacketSize));</div><div class="line">                    }</div><div class="line">                }</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga69d2f77efcabbdf57be21ab9465ee70f">MV_CC_SetEnumValue</a>(handle,<span class="stringliteral">&quot;TriggerMode&quot;</span>, MV_TRIGGER_MODE_OFF);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Set Trigger Mode fail! nRet&quot;</span> + nRet);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="comment">// ch:开启Event | en:Set Event of ExposureEnd On</span></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga8861f8b89c74c71bb37a270894a43124">MV_CC_SetEnumValueByString</a>(handle,<span class="stringliteral">&quot;EventSelector&quot;</span>, <span class="stringliteral">&quot;ExposureEnd&quot;</span>);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Set Event Selector fail! nRet&quot;</span> + nRet);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga8861f8b89c74c71bb37a270894a43124">MV_CC_SetEnumValueByString</a>(handle,<span class="stringliteral">&quot;EventNotification&quot;</span>, <span class="stringliteral">&quot;On&quot;</span>);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Set Event Notification fail! nRet &quot;</span> + nRet);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="comment">// ch:注册事件回调 | en:Register event callback</span></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE9_x80_x9A_xE7_x94_xA8_xE6_x8E_xA5_xE5_x8F_xA3.html#gaefc9935a7ae3939ef6e982a4a95104c7">MV_CC_RegisterEventCallBack</a>(handle,<span class="stringliteral">&quot;ExposureEnd&quot;</span>, <span class="keyword">new</span> <a class="code" href="group___xE5_x9B_x9E_xE8_xB0_x83_xE5_x87_xBD_xE6_x95_xB0.html#ga2a0fc9ec72d06852f0289150c4b94a54">CameraEventCallBack</a>() {</div><div class="line">                    @Override</div><div class="line">                    <span class="keyword">public</span> <span class="keywordtype">int</span> OnEventCallBack(MvCameraControlDefines.MV_EVENT_OUT_INFO info) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;eventCallBack:&quot;</span> + info.eventName);</div><div class="line">                        <span class="keywordflow">return</span> 0;</div><div class="line">                    }</div><div class="line">                });</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Register Event CallBack fail! nRet &quot;</span> + nRet);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="comment">// 开始取流</span></div><div class="line">                <span class="comment">// start grab image</span></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga5ee1c63aac34f3d8ea0ea5c2f5f734f2">MV_CC_StartGrabbing</a>(handle);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_StartGrabbing fail! nRet&quot;</span> + nRet);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                toast(<span class="stringliteral">&quot;Please enumerate the devices first&quot;</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">class </span>CloseDeviceThread <span class="keyword">extends</span> Thread {</div><div class="line">        @Override</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">            super.run();</div><div class="line">            <span class="comment">// 停止取流</span></div><div class="line">            <span class="comment">// end grab image</span></div><div class="line">            <span class="keywordtype">int</span> nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga951784eace474e8a5049c911966c381f">MV_CC_StopGrabbing</a>(handle);</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                showLog(<span class="stringliteral">&quot;MV_CC_StopGrabbing fail! nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">            }</div><div class="line">            <span class="comment">// 关闭设备</span></div><div class="line">            <span class="comment">// close device</span></div><div class="line">            nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga9200ad9b866b2fc9b8cae94fbba56fde">MV_CC_CloseDevice</a>(handle);</div><div class="line">            <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                showLog(<span class="stringliteral">&quot;MV_CC_CloseDevice fail! nRet &quot;</span> + nRet);</div><div class="line">            }</div><div class="line">            <span class="comment">// 销毁句柄</span></div><div class="line">            <span class="comment">// destroy handle</span></div><div class="line">            nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga8385105a0abb3a23dc2728ce980656ba">MV_CC_DestroyHandle</a>(handle);</div><div class="line">            <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                showLog(<span class="stringliteral">&quot;MV_CC_DestroyHandle fail! nRet&quot;</span> + nRet);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onDestroy() {</div><div class="line">        super.onDestroy();</div><div class="line">        <span class="keywordflow">if</span> (closeDeviceBt.isEnabled()) {</div><div class="line">            closeDevice();</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="获取BMP格式图像"></a>
GetBitmapActivity.java</h1>
<p>获取BMP格式图像</p>
<p>该示例程序说明了如何通过GetBitmap接口获取BMP格式的图像数据。 </p><div class="fragment"><div class="line"><span class="keyword">package </span>com.example.getbitmap;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.graphics.Bitmap;</div><div class="line"><span class="keyword">import</span> android.graphics.BitmapFactory;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.text.method.ScrollingMovementMethod;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.Button;</div><div class="line"><span class="keyword">import</span> android.widget.EditText;</div><div class="line"><span class="keyword">import</span> android.widget.ImageView;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.CameraManager;</div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.IMainView;</div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.LogView;</div><div class="line"><span class="keyword">import</span> com.jaredrummler.materialspinner.MaterialSpinner;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.CameraControlException;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControl;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControlDefines;</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> MvCameraControlWrapper.MvCameraControlDefines.MV_OK;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>GetBitmapActivity <span class="keyword">extends</span> AppCompatActivity implements IMainView {</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ArrayList&lt;MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a>&gt; deviceList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">private</span> MaterialSpinner spinner;</div><div class="line">    <span class="keyword">private</span> ImageView imageView;</div><div class="line">    EditText logTv;</div><div class="line">    <span class="keywordtype">int</span> selectNum = 0;</div><div class="line">    Button closeDeviceBt;</div><div class="line">    Button openDeviceBt;</div><div class="line">    <span class="keywordtype">byte</span>[] datas = <span class="keyword">null</span>;</div><div class="line">    MvCameraControlDefines. <a class="code" href="class_m_v___f_r_a_m_e___o_u_t___i_n_f_o.html">MV_FRAME_OUT_INFO</a> info = <span class="keyword">new</span> MvCameraControlDefines. <a class="code" href="class_m_v___f_r_a_m_e___o_u_t___i_n_f_o.html">MV_FRAME_OUT_INFO</a>();</div><div class="line">    GetBitmapThread getBitmapThread;</div><div class="line">    MvCameraControlDefines.Handle handle = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onCreate(Bundle savedInstanceState) {</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_get_bitmap);</div><div class="line">        initView();</div><div class="line">        initListener();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initView() {</div><div class="line">        spinner = findViewById(R.id.spinner);</div><div class="line">        logTv = findViewById(R.id.logTv);</div><div class="line">        logTv.setMovementMethod(ScrollingMovementMethod.getInstance());</div><div class="line">        openDeviceBt = findViewById(R.id.openDeviceBt);</div><div class="line">        closeDeviceBt = findViewById(R.id.closeDeviceBt);</div><div class="line">        imageView = findViewById(R.id.imageView);</div><div class="line">        spinner.setOnItemSelectedListener(<span class="keyword">new</span> MaterialSpinner.OnItemSelectedListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onItemSelected(MaterialSpinner view, <span class="keywordtype">int</span> position, <span class="keywordtype">long</span> <span class="keywordtype">id</span>, Object item) {</div><div class="line">                selectNum = position;</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initListener() {</div><div class="line">        findViewById(R.id.enumDevicesBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                selectNum = 0;</div><div class="line">                deviceList.clear();</div><div class="line">                spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    deviceList = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga2e162b1972c75982ff1c52e1c5d34a4e">MV_CC_EnumDevices</a>(MvCameraControlDefines.MV_USB_DEVICE | MvCameraControlDefines.MV_GIGE_DEVICE);</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (deviceList != <span class="keyword">null</span>) {</div><div class="line">                    <span class="keywordtype">int</span> size = deviceList.size();</div><div class="line">                    <span class="keywordflow">if</span> (size &gt; 0) {</div><div class="line">                        List&lt;String&gt; deviceName = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++) {</div><div class="line">                            MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a> entity = deviceList.get(i);</div><div class="line">                            <span class="keywordflow">if</span> (entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines.MV_GIGE_DEVICE) {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a9e8dbdf67802699038b0421c0d311499">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a727f4f765547596fdca29f86a2406dc9">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a0a3a766f998932a02e10e0223b05801c">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#ac0d8c9621aa38cb936f906d981c6a31b">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            } <span class="keywordflow">else</span> {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#ac568233b448c639976fe3280fcc2d0d5">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aeecafd7f0254f5bad432f2323b202700">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#a6b9a01f50a786e68ab65f3ba33079d26">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aac5ebaab488a72e9a7dcb2a5818e33bc">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            }</div><div class="line"></div><div class="line">                        }</div><div class="line">                        spinner.setItems(deviceName);</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                    }</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Not enumerated to device&quot;</span>);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        findViewById(R.id.openDeviceBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                openDevice();</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        findViewById(R.id.closeDeviceBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                closeDevice();</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> openDevice() {</div><div class="line">        <span class="keywordflow">if</span> (getBitmapThread == <span class="keyword">null</span>) {</div><div class="line">            getBitmapThread = <span class="keyword">new</span> GetBitmapThread(<span class="keyword">new</span> IExitGetOneFrame() {</div><div class="line">                @Override</div><div class="line">                <span class="keyword">public</span> <span class="keywordtype">void</span> exit() {</div><div class="line">                    <span class="comment">// 停止取流</span></div><div class="line">                    <span class="comment">// end grab image</span></div><div class="line">                    <span class="keywordtype">int</span> nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga951784eace474e8a5049c911966c381f">MV_CC_StopGrabbing</a>(handle);</div><div class="line">                    <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;MV_CC_StopGrabbing fail! nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    }</div><div class="line">                    <span class="comment">// 关闭设备</span></div><div class="line">                    <span class="comment">// close device</span></div><div class="line">                    nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga9200ad9b866b2fc9b8cae94fbba56fde">MV_CC_CloseDevice</a>(handle);</div><div class="line">                    <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;MV_CC_CloseDevice fail! nRet &quot;</span> + nRet);</div><div class="line">                    }</div><div class="line">                    <span class="comment">// 销毁句柄</span></div><div class="line">                    <span class="comment">// destroy handle</span></div><div class="line">                    nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga8385105a0abb3a23dc2728ce980656ba">MV_CC_DestroyHandle</a>(handle);</div><div class="line">                    <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;MV_CC_DestroyHandle fail! nRet&quot;</span> + nRet);</div><div class="line">                    }</div><div class="line"></div><div class="line">                }</div><div class="line">            });</div><div class="line">            getBitmapThread.flag = <span class="keyword">true</span>;</div><div class="line">            getBitmapThread.start();</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            <span class="keywordflow">if</span> (!getBitmapThread.isAlive()) {</div><div class="line">                getBitmapThread.flag = <span class="keyword">true</span>;</div><div class="line">                getBitmapThread.start();</div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                showLog(<span class="stringliteral">&quot;Please try again later&quot;</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> showLog(<span class="keyword">final</span> String str) {</div><div class="line">        LogView.showLog(<span class="keyword">this</span>,logTv,str);</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateButton(<span class="keywordtype">int</span> state) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateImage(<span class="keywordtype">byte</span>[] data) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> toast(<span class="keyword">final</span> String <span class="keywordtype">string</span>) {</div><div class="line">        runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                Toast.makeText(GetBitmapActivity.this, <span class="keywordtype">string</span>, Toast.LENGTH_SHORT).show();</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> closeDevice() {</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (getBitmapThread != <span class="keyword">null</span>) {</div><div class="line">            getBitmapThread.flag = <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onDestroy() {</div><div class="line">        super.onDestroy();</div><div class="line">        <span class="keywordflow">if</span> (closeDeviceBt.isEnabled()) {</div><div class="line">            closeDevice();</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">class </span>GetBitmapThread <span class="keyword">extends</span> Thread {</div><div class="line"></div><div class="line">        <span class="keywordtype">boolean</span> flag = <span class="keyword">true</span>;</div><div class="line">        IExitGetOneFrame iExitGetOneFrame;</div><div class="line"></div><div class="line">        GetBitmapThread(IExitGetOneFrame iExitGetOneFrame) {</div><div class="line">            this.iExitGetOneFrame = iExitGetOneFrame;</div><div class="line">        }</div><div class="line"></div><div class="line"></div><div class="line">        @Override</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">            super.run();</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (deviceList != <span class="keyword">null</span> &amp;&amp; deviceList.size() &gt; 0) {</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    handle = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#gae94fdee0967a330a197b783c781e36fb">MV_CC_CreateHandle</a>(deviceList.get(selectNum));</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> ( handle == <span class="keyword">null</span>) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;CreateHandle fail! nRet&quot;</span>);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordtype">int</span> nRet = MV_OK;</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga4e982ac1afd05dec95710ac2adcb6c6a">MV_CC_OpenDevice</a>(handle);</div><div class="line">                <span class="keywordflow">if</span> (nRet != 0) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;OpenDevice fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (deviceList.get(selectNum).<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines.MV_GIGE_DEVICE) {</div><div class="line">                    <span class="keywordtype">int</span> nPacketSize = MvCameraControl. <a class="code" href="group___gig_e_xE6_x8E_xA5_xE5_x8F_xA3_xE5_x87_xBD_xE6_x95_xB0.html#ga86ef17ec299b0ff442a063132ced4e6b">MV_CC_GetOptimalPacketSize</a>(handle);</div><div class="line">                    showLog(<span class="stringliteral">&quot;nPacketSize:&quot;</span> + nPacketSize + <span class="stringliteral">&quot;&quot;</span>);</div><div class="line">                    <span class="keywordflow">if</span> (nPacketSize &gt; 0) {</div><div class="line">                        nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga8932770d409766b20cc6819b6d48733f">MV_CC_SetIntValue</a>(handle,<span class="stringliteral">&quot;GevSCPSPacketSize&quot;</span>, nPacketSize);</div><div class="line">                        <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                            showLog(<span class="stringliteral">&quot;Warning: Set Packet Size fail nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">                            <span class="keywordflow">return</span>;</div><div class="line">                        }</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        showLog(<span class="stringliteral">&quot;Warning: Get Packet Size fail nRet&quot;</span> + Integer.toHexString(nPacketSize));</div><div class="line">                    }</div><div class="line">                }</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga69d2f77efcabbdf57be21ab9465ee70f">MV_CC_SetEnumValue</a>(handle,<span class="stringliteral">&quot;TriggerMode&quot;</span>, 0);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_SetTriggerMode fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                Integer width = <span class="keyword">new</span> Integer(0);</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga44cb71a1f783fef852b51c1405560ce1">MV_CC_GetIntValue</a>(handle,<span class="stringliteral">&quot;Width&quot;</span>, width);</div><div class="line">                <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;GetWidth fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                Integer height = <span class="keyword">new</span> Integer(0);</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga44cb71a1f783fef852b51c1405560ce1">MV_CC_GetIntValue</a>(handle,<span class="stringliteral">&quot;Height&quot;</span>, height);</div><div class="line">                <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;GetHeight fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                datas = <span class="keyword">new</span> <span class="keywordtype">byte</span>[width * height * 4];</div><div class="line"></div><div class="line">                <span class="comment">// 开始取流</span></div><div class="line">                <span class="comment">// start grab image</span></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga5ee1c63aac34f3d8ea0ea5c2f5f734f2">MV_CC_StartGrabbing</a>(handle);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_StartGrabbing fail! nRet&quot;</span> + nRet);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                toast(<span class="stringliteral">&quot;Please enumerate the devices first&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line">                <span class="keywordflow">if</span> (flag == <span class="keyword">false</span>) {</div><div class="line">                    <span class="keywordflow">if</span> (iExitGetOneFrame != <span class="keyword">null</span>) {</div><div class="line">                        iExitGetOneFrame.exit();</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line"></div><div class="line">                    <span class="keywordtype">int</span> nRet1 = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#gaba79fc6858614601cbd712219c3a675c">MV_CC_GetBitmapTimeout</a>(handle,datas, info, 2000);</div><div class="line">                    <span class="keywordflow">if</span> (nRet1 == MV_OK) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;GetOneFrame,Width:&quot;</span> + info.<a class="code" href="class_m_v___f_r_a_m_e___o_u_t___i_n_f_o.html#a86df2b6d2a05dee40f1782a918d66dc1">width</a> +</div><div class="line">                                <span class="stringliteral">&quot;Height:&quot;</span> + info.<a class="code" href="class_m_v___f_r_a_m_e___o_u_t___i_n_f_o.html#aeb2fa1f3e524b4da7903434fffa08e99">height</a> +</div><div class="line">                                <span class="stringliteral">&quot;nFrameNum&quot;</span> + info.<a class="code" href="class_m_v___f_r_a_m_e___o_u_t___i_n_f_o.html#aa3bbbe29bf31abe6bec81bfed7ebc2df">frameNum</a>);</div><div class="line">                        runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">                            @Override</div><div class="line">                            <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                                BitmapFactory.Options options = <span class="keyword">new</span> BitmapFactory.Options();</div><div class="line">                                options.inSampleSize = 2;</div><div class="line">                                Bitmap bm = BitmapFactory.decodeByteArray(datas, 0, info.<a class="code" href="class_m_v___f_r_a_m_e___o_u_t___i_n_f_o.html#abc03fcbfbb79f1d48efdbf3e196ae474">frameLen</a>, options);</div><div class="line"></div><div class="line"></div><div class="line">                                <span class="keywordflow">if</span> (bm != <span class="keyword">null</span>) {</div><div class="line">                                    imageView.setImageBitmap(bm);</div><div class="line">                                }</div><div class="line">                            }</div><div class="line">                        });</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        showLog(<span class="stringliteral">&quot;OneFrameTimeout fail：nRet = &quot;</span> + Integer.toHexString(nRet1));</div><div class="line">                        <span class="keywordflow">try</span> {</div><div class="line">                            Thread.sleep(1000);</div><div class="line">                        } <span class="keywordflow">catch</span> (InterruptedException e) {</div><div class="line">                            e.printStackTrace();</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="获取相机图像"></a>
GrabImageActivity.java</h1>
<p>获取相机图像</p>
<p>该示例程序说明了如何通过主动取图的方式获取相机图像。创建句柄，打开相机，开始取流，创建取流线程（用户分配采集buffer， <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#gae1a51a885f885902d8783e1237556e48" title="获取一帧图像数据">MV_CC_GetOneFrameTimeout()</a> 取图（拷贝）），停止取流，关闭相机，销毁句柄。 </p><div class="fragment"><div class="line"><span class="keyword">package </span>com.example.grabimage;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.Button;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.IMainView;</div><div class="line"><span class="keyword">import</span> com.jaredrummler.materialspinner.MaterialSpinner;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.CameraControlException;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControl;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControlDefines;</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> MvCameraControlWrapper.MvCameraControlDefines.MV_OK;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>GrabImageActivity <span class="keyword">extends</span> AppCompatActivity implements IMainView {</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ArrayList&lt;MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a>&gt; deviceList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">private</span> MaterialSpinner spinner;</div><div class="line">    TextView logTv;</div><div class="line">    <span class="keywordtype">int</span> selectNum = 0;</div><div class="line">    Button closeDeviceBt;</div><div class="line">    Button openDeviceBt;</div><div class="line">    <span class="keywordtype">byte</span>[] datas = <span class="keyword">null</span>;</div><div class="line">    MvCameraControlDefines. <a class="code" href="class_m_v___f_r_a_m_e___o_u_t___i_n_f_o.html">MV_FRAME_OUT_INFO</a> info = <span class="keyword">new</span> MvCameraControlDefines. <a class="code" href="class_m_v___f_r_a_m_e___o_u_t___i_n_f_o.html">MV_FRAME_OUT_INFO</a>();</div><div class="line">    GetOneFrameThread getOneFrameThread;</div><div class="line">    MvCameraControlDefines.Handle handle = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onCreate(Bundle savedInstanceState) {</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_grab_image_main);</div><div class="line">        initView();</div><div class="line">        initListener();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initView() {</div><div class="line">        spinner = findViewById(R.id.spinner);</div><div class="line">        logTv = findViewById(R.id.logTv);</div><div class="line">        openDeviceBt = findViewById(R.id.openDeviceBt);</div><div class="line">        closeDeviceBt = findViewById(R.id.closeDeviceBt);</div><div class="line">        spinner.setOnItemSelectedListener(<span class="keyword">new</span> MaterialSpinner.OnItemSelectedListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onItemSelected(MaterialSpinner view, <span class="keywordtype">int</span> position, <span class="keywordtype">long</span> <span class="keywordtype">id</span>, Object item) {</div><div class="line">                selectNum = position;</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initListener() {</div><div class="line">        findViewById(R.id.enumDevicesBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                selectNum = 0;</div><div class="line">                deviceList.clear();</div><div class="line">                spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    deviceList =  MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga2e162b1972c75982ff1c52e1c5d34a4e">MV_CC_EnumDevices</a>(MvCameraControlDefines.MV_USB_DEVICE | MvCameraControlDefines.MV_GIGE_DEVICE);</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (deviceList != <span class="keyword">null</span>) {</div><div class="line">                    <span class="keywordtype">int</span> size = deviceList.size();</div><div class="line">                    <span class="keywordflow">if</span> (size &gt; 0) {</div><div class="line">                        List&lt;String&gt; deviceName = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++) {</div><div class="line">                            MvCameraControlDefines.MV_CC_DEVICE_INFO entity = deviceList.get(i);</div><div class="line">                            <span class="keywordflow">if</span> (entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines.MV_GIGE_DEVICE) {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a9e8dbdf67802699038b0421c0d311499">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a727f4f765547596fdca29f86a2406dc9">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a0a3a766f998932a02e10e0223b05801c">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#ac0d8c9621aa38cb936f906d981c6a31b">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            } <span class="keywordflow">else</span> {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#ac568233b448c639976fe3280fcc2d0d5">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aeecafd7f0254f5bad432f2323b202700">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#a6b9a01f50a786e68ab65f3ba33079d26">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aac5ebaab488a72e9a7dcb2a5818e33bc">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            }</div><div class="line"></div><div class="line">                        }</div><div class="line">                        spinner.setItems(deviceName);</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                    }</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Not enumerated to device&quot;</span>);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        findViewById(R.id.openDeviceBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                openDevice();</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        findViewById(R.id.closeDeviceBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                closeDevice();</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> openDevice() {</div><div class="line">        <span class="keywordflow">if</span> (getOneFrameThread == <span class="keyword">null</span>) {</div><div class="line">            getOneFrameThread = <span class="keyword">new</span> GetOneFrameThread(<span class="keyword">new</span> IExitGetOneFrame() {</div><div class="line">                @Override</div><div class="line">                <span class="keyword">public</span> <span class="keywordtype">void</span> exit() {</div><div class="line">                    <span class="comment">// 停止取流</span></div><div class="line">                    <span class="comment">// end grab image</span></div><div class="line">                    <span class="keywordtype">int</span> nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga951784eace474e8a5049c911966c381f">MV_CC_StopGrabbing</a>(handle);</div><div class="line">                    <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;MV_CC_StopGrabbing fail! nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    }</div><div class="line">                    <span class="comment">// 关闭设备</span></div><div class="line">                    <span class="comment">// close device</span></div><div class="line">                    nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga9200ad9b866b2fc9b8cae94fbba56fde">MV_CC_CloseDevice</a>(handle);</div><div class="line">                    <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;MV_CC_CloseDevice fail! nRet &quot;</span> + nRet);</div><div class="line">                    }</div><div class="line">                    <span class="comment">// 销毁句柄</span></div><div class="line">                    <span class="comment">// destroy handle</span></div><div class="line">                    nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga8385105a0abb3a23dc2728ce980656ba">MV_CC_DestroyHandle</a>(handle);</div><div class="line">                    <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;MV_CC_DestroyHandle fail! nRet&quot;</span> + nRet);</div><div class="line">                    }</div><div class="line">                    runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">                        @Override</div><div class="line">                        <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                            closeDeviceBt.setEnabled(<span class="keyword">false</span>);</div><div class="line">                            openDeviceBt.setEnabled(<span class="keyword">true</span>);</div><div class="line">                        }</div><div class="line">                    });</div><div class="line">                }</div><div class="line">            });</div><div class="line">            getOneFrameThread.start();</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            <span class="keywordflow">if</span> (!getOneFrameThread.isAlive()) {</div><div class="line">                getOneFrameThread.start();</div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                showLog(<span class="stringliteral">&quot;Please try again later&quot;</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> showLog(<span class="keyword">final</span> String str) {</div><div class="line">        runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                <span class="keywordflow">if</span> (logTv.getLineCount() &gt; 150) {</div><div class="line">                    logTv.setText(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                logTv.append(str + <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">                <span class="keywordtype">int</span> offset = logTv.getLineCount() * logTv.getLineHeight();</div><div class="line">                <span class="keywordflow">if</span> (offset &gt; logTv.getHeight()) {</div><div class="line">                    logTv.scrollTo(0, offset - logTv.getHeight());</div><div class="line">                }</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateButton(<span class="keywordtype">int</span> state) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateImage(<span class="keywordtype">byte</span>[] data) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> toast(<span class="keyword">final</span> String <span class="keywordtype">string</span>) {</div><div class="line">        runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                Toast.makeText(GrabImageActivity.this, <span class="keywordtype">string</span>, Toast.LENGTH_SHORT).show();</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> closeDevice() {</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (getOneFrameThread != <span class="keyword">null</span>) {</div><div class="line">            <span class="keywordflow">if</span> (!getOneFrameThread.isInterrupted()) {</div><div class="line">                getOneFrameThread.interrupt();</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onDestroy() {</div><div class="line">        super.onDestroy();</div><div class="line">        <span class="keywordflow">if</span> (closeDeviceBt.isEnabled()) {</div><div class="line">            closeDevice();</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">class </span>GetOneFrameThread <span class="keyword">extends</span> Thread {</div><div class="line">        IExitGetOneFrame iExitGetOneFrame;</div><div class="line"></div><div class="line">        <span class="keyword">public</span> GetOneFrameThread(IExitGetOneFrame iExitGetOneFrame) {</div><div class="line">            this.iExitGetOneFrame = iExitGetOneFrame;</div><div class="line">        }</div><div class="line"></div><div class="line">        @Override</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">            super.run();</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (deviceList != <span class="keyword">null</span> &amp;&amp; deviceList.size() &gt; 0) {</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    handle = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#gae94fdee0967a330a197b783c781e36fb">MV_CC_CreateHandle</a>(deviceList.get(selectNum));</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (handle == <span class="keyword">null</span>) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;CreateHandle fail! nRet&quot;</span>);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordtype">int</span> nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga4e982ac1afd05dec95710ac2adcb6c6a">MV_CC_OpenDevice</a>(handle);</div><div class="line">                <span class="keywordflow">if</span> (nRet != 0) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;OpenDevice fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (deviceList.get(selectNum).<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines.MV_GIGE_DEVICE) {</div><div class="line">                    <span class="keywordtype">int</span> nPacketSize = MvCameraControl. <a class="code" href="group___gig_e_xE6_x8E_xA5_xE5_x8F_xA3_xE5_x87_xBD_xE6_x95_xB0.html#ga86ef17ec299b0ff442a063132ced4e6b">MV_CC_GetOptimalPacketSize</a>(handle);</div><div class="line">                    <span class="keywordflow">if</span> (nPacketSize &gt; 0) {</div><div class="line">                        nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga8932770d409766b20cc6819b6d48733f">MV_CC_SetIntValue</a>(handle,<span class="stringliteral">&quot;GevSCPSPacketSize&quot;</span>, nPacketSize);</div><div class="line">                        <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                            showLog(<span class="stringliteral">&quot;Warning: Set Packet Size fail nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">                            <span class="keywordflow">return</span>;</div><div class="line">                        }</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        showLog(<span class="stringliteral">&quot;Warning: Get Packet Size fail nRet&quot;</span> + Integer.toHexString(nPacketSize));</div><div class="line">                    }</div><div class="line">                }</div><div class="line">                <span class="comment">// 开始取流</span></div><div class="line">                <span class="comment">// start grab image</span></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga5ee1c63aac34f3d8ea0ea5c2f5f734f2">MV_CC_StartGrabbing</a>(handle);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_StartGrabbing fail! nRet&quot;</span> + nRet);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">                    @Override</div><div class="line">                    <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                        openDeviceBt.setEnabled(<span class="keyword">false</span>);</div><div class="line">                        closeDeviceBt.setEnabled(<span class="keyword">true</span>);</div><div class="line">                    }</div><div class="line">                });</div><div class="line"></div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                toast(<span class="stringliteral">&quot;Please enumerate the devices first&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            Integer width = <span class="keyword">new</span> Integer(0);</div><div class="line">            <span class="keywordtype">int</span> nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga44cb71a1f783fef852b51c1405560ce1">MV_CC_GetIntValue</a>(handle,<span class="stringliteral">&quot;Width&quot;</span>, width);</div><div class="line">            <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                showLog(<span class="stringliteral">&quot;GetWidth fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            Integer height = <span class="keyword">new</span> Integer(0);</div><div class="line">            nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga44cb71a1f783fef852b51c1405560ce1">MV_CC_GetIntValue</a>(handle,<span class="stringliteral">&quot;Height&quot;</span>, height);</div><div class="line">            <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                showLog(<span class="stringliteral">&quot;GetHeight fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            datas = <span class="keyword">new</span> <span class="keywordtype">byte</span>[width * height * 3];</div><div class="line"></div><div class="line">            <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line">                <span class="keywordflow">if</span> (isInterrupted()) {</div><div class="line">                    <span class="keywordflow">if</span> (iExitGetOneFrame != <span class="keyword">null</span>) {</div><div class="line">                        iExitGetOneFrame.exit();</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    <span class="keywordtype">int</span> nRet1 = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#gae1a51a885f885902d8783e1237556e48">MV_CC_GetOneFrameTimeout</a>(handle,datas, info, 1000);</div><div class="line">                    <span class="keywordflow">if</span> (nRet1 == MV_OK) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;GetOneFrame,Width:&quot;</span> + info.<a class="code" href="class_m_v___f_r_a_m_e___o_u_t___i_n_f_o.html#a86df2b6d2a05dee40f1782a918d66dc1">width</a> +</div><div class="line">                                <span class="stringliteral">&quot;Height:&quot;</span> + info.<a class="code" href="class_m_v___f_r_a_m_e___o_u_t___i_n_f_o.html#aeb2fa1f3e524b4da7903434fffa08e99">height</a> +</div><div class="line">                                <span class="stringliteral">&quot;nFrameNum&quot;</span> + info.<a class="code" href="class_m_v___f_r_a_m_e___o_u_t___i_n_f_o.html#aa3bbbe29bf31abe6bec81bfed7ebc2df">frameNum</a>);</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        showLog(<span class="stringliteral">&quot;OneFrameTimeout fail：nRet = &quot;</span> + Integer.toHexString(nRet1));</div><div class="line">                        <span class="keywordflow">try</span> {</div><div class="line">                            Thread.sleep(1000);</div><div class="line">                        } <span class="keywordflow">catch</span> (InterruptedException e) {</div><div class="line">                            e.printStackTrace();</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="通过回调获取相机图像"></a>
GrabImageCallBackActivity.java</h1>
<p>通过回调获取相机图像</p>
<p>该示例程序说明了如何通过回调的方式获取相机图像。创建句柄，打开相机，注册回调函数，开始取流，在回调函数中可以获取到图像相关信息，停止取流，关闭相机，销毁句柄。 </p><div class="fragment"><div class="line"><span class="keyword">package </span>com.example.grabimagecallback;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.text.method.ScrollingMovementMethod;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.Button;</div><div class="line"><span class="keyword">import</span> android.widget.EditText;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.IMainView;</div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.LogView;</div><div class="line"><span class="keyword">import</span> com.jaredrummler.materialspinner.MaterialSpinner;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.CameraControlException;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.CameraImageCallBack;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControl;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControlDefines;</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> MvCameraControlWrapper.MvCameraControlDefines.MV_OK;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>GrabImageCallBackActivity <span class="keyword">extends</span> AppCompatActivity implements IMainView {</div><div class="line">    <span class="keyword">private</span> ArrayList&lt;MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a>&gt; deviceList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">private</span> MaterialSpinner spinner;</div><div class="line">    EditText logTv;</div><div class="line">    <span class="keywordtype">int</span> selectNum = 0;</div><div class="line">    Button closeDeviceBt;</div><div class="line">    Button openDeviceBt;</div><div class="line">    OpenDeviceThread openDeviceThread = <span class="keyword">null</span>;</div><div class="line">    CloseDeviceThread closeDeviceThread = <span class="keyword">null</span>;</div><div class="line">    MvCameraControlDefines.Handle handle = <span class="keyword">null</span>;</div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onCreate(Bundle savedInstanceState) {</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_grabimagecallback_main);</div><div class="line">        initView();</div><div class="line">        initListener();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initView() {</div><div class="line">        spinner = findViewById(R.id.spinner);</div><div class="line">        logTv = findViewById(R.id.logTv);</div><div class="line">        logTv.setMovementMethod(ScrollingMovementMethod.getInstance());</div><div class="line">        openDeviceBt = findViewById(R.id.openDeviceBt);</div><div class="line">        closeDeviceBt = findViewById(R.id.closeDeviceBt);</div><div class="line">        spinner.setOnItemSelectedListener(<span class="keyword">new</span> MaterialSpinner.OnItemSelectedListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onItemSelected(MaterialSpinner view, <span class="keywordtype">int</span> position, <span class="keywordtype">long</span> <span class="keywordtype">id</span>, Object item) {</div><div class="line">                selectNum = position;</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initListener() {</div><div class="line">        findViewById(R.id.enumDevicesBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                selectNum = 0;</div><div class="line">                deviceList.clear();</div><div class="line">                spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    deviceList =  MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga2e162b1972c75982ff1c52e1c5d34a4e">MV_CC_EnumDevices</a>(MvCameraControlDefines.MV_USB_DEVICE | MvCameraControlDefines.MV_GIGE_DEVICE);</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (deviceList != <span class="keyword">null</span>) {</div><div class="line">                    <span class="keywordtype">int</span> size = deviceList.size();</div><div class="line">                    <span class="keywordflow">if</span> (size &gt; 0) {</div><div class="line">                        List&lt;String&gt; deviceName = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++) {</div><div class="line">                            MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a> entity = deviceList.get(i);</div><div class="line">                            <span class="keywordflow">if</span> (entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines.MV_GIGE_DEVICE) {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a9e8dbdf67802699038b0421c0d311499">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a727f4f765547596fdca29f86a2406dc9">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a0a3a766f998932a02e10e0223b05801c">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#ac0d8c9621aa38cb936f906d981c6a31b">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            } <span class="keywordflow">else</span> {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#ac568233b448c639976fe3280fcc2d0d5">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aeecafd7f0254f5bad432f2323b202700">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#a6b9a01f50a786e68ab65f3ba33079d26">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aac5ebaab488a72e9a7dcb2a5818e33bc">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            }</div><div class="line">                        }</div><div class="line">                        spinner.setItems(deviceName);</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                    }</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Not enumerated to device&quot;</span>);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        findViewById(R.id.openDeviceBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                openDevice();</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        findViewById(R.id.closeDeviceBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                closeDevice();</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> showLog(<span class="keyword">final</span> String str) {</div><div class="line">        LogView.showLog(<span class="keyword">this</span>,logTv,str);</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateButton(<span class="keywordtype">int</span> state) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateImage(<span class="keywordtype">byte</span>[] data) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> toast(<span class="keyword">final</span> String <span class="keywordtype">string</span>) {</div><div class="line">        runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                Toast.makeText(GrabImageCallBackActivity.this, <span class="keywordtype">string</span>, Toast.LENGTH_SHORT).show();</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> openDevice() {</div><div class="line">        <span class="keywordflow">if</span> (openDeviceThread == <span class="keyword">null</span>) {</div><div class="line">            openDeviceThread = <span class="keyword">new</span> OpenDeviceThread();</div><div class="line">            openDeviceThread.start();</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            <span class="keywordflow">if</span> (!openDeviceThread.isAlive()){</div><div class="line">                openDeviceThread.start();</div><div class="line">            }<span class="keywordflow">else</span> {</div><div class="line">                showLog(<span class="stringliteral">&quot;Please try again later&quot;</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> closeDevice() {</div><div class="line">        <span class="keywordflow">if</span> (closeDeviceThread == <span class="keyword">null</span>){</div><div class="line">            closeDeviceThread = <span class="keyword">new</span> CloseDeviceThread();</div><div class="line">            closeDeviceThread.start();</div><div class="line">        }<span class="keywordflow">else</span> {</div><div class="line">            <span class="keywordflow">if</span> (!closeDeviceThread.isAlive()){</div><div class="line">                closeDeviceThread.start();</div><div class="line">            }<span class="keywordflow">else</span> {</div><div class="line">                showLog(<span class="stringliteral">&quot;Please try again later&quot;</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">class </span>OpenDeviceThread <span class="keyword">extends</span> Thread {</div><div class="line">        @Override</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">            super.run();</div><div class="line">            <span class="keywordflow">if</span> (deviceList != <span class="keyword">null</span> &amp;&amp; deviceList.size() &gt; 0) {</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    handle = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#gae94fdee0967a330a197b783c781e36fb">MV_CC_CreateHandle</a>(deviceList.get(selectNum));</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (handle == <span class="keyword">null</span>) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;CreateHandle fail! nRet&quot;</span>);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordtype">int</span> nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga4e982ac1afd05dec95710ac2adcb6c6a">MV_CC_OpenDevice</a>(handle);</div><div class="line">                <span class="keywordflow">if</span> (nRet != 0) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;OpenDevice fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (deviceList.get(selectNum).<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines.MV_GIGE_DEVICE) {</div><div class="line">                    <span class="keywordtype">int</span> nPacketSize = MvCameraControl. <a class="code" href="group___gig_e_xE6_x8E_xA5_xE5_x8F_xA3_xE5_x87_xBD_xE6_x95_xB0.html#ga86ef17ec299b0ff442a063132ced4e6b">MV_CC_GetOptimalPacketSize</a>(handle);</div><div class="line">                    <span class="keywordflow">if</span> (nPacketSize &gt; 0) {</div><div class="line">                        nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga8932770d409766b20cc6819b6d48733f">MV_CC_SetIntValue</a>(handle,<span class="stringliteral">&quot;GevSCPSPacketSize&quot;</span>, nPacketSize);</div><div class="line">                        <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                            showLog(<span class="stringliteral">&quot;Warning: Set Packet Size fail nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">                            <span class="keywordflow">return</span>;</div><div class="line">                        }</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        showLog(<span class="stringliteral">&quot;Warning: Get Packet Size fail nRet&quot;</span> + Integer.toHexString(nPacketSize));</div><div class="line">                    }</div><div class="line">                }</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga69d2f77efcabbdf57be21ab9465ee70f">MV_CC_SetEnumValue</a>(handle,<span class="stringliteral">&quot;TriggerMode&quot;</span>, 0);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_SetTriggerMode fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="comment">// 注册抓图回调</span></div><div class="line">                <span class="comment">// register image callback</span></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga52ef975ad47c0ad8ea71480c64e71d80">MV_CC_RegisterImageCallBack</a>(handle,<span class="keyword">new</span> <a class="code" href="group___xE5_x9B_x9E_xE8_xB0_x83_xE5_x87_xBD_xE6_x95_xB0.html#gad8559ccfcfe48b541d40b440a63ef641">CameraImageCallBack</a>() {</div><div class="line">                    @Override</div><div class="line">                    <span class="keyword">public</span> <span class="keywordtype">int</span> OnImageCallBack(<span class="keywordtype">byte</span>[] bytes, <span class="keyword">final</span> MvCameraControlDefines.MV_FRAME_OUT_INFO mv_frame_out_info) {</div><div class="line">                        runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">                            @Override</div><div class="line">                            <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                                showLog(<span class="stringliteral">&quot;GetOneFrame, Width:&quot;</span> + mv_frame_out_info.width +</div><div class="line">                                        <span class="stringliteral">&quot;Height:&quot;</span> + mv_frame_out_info.height +</div><div class="line">                                        <span class="stringliteral">&quot;nFrameNum&quot;</span> + mv_frame_out_info.frameNum);</div><div class="line">                            }</div><div class="line">                        });</div><div class="line"></div><div class="line">                        <span class="keywordflow">return</span> 0;</div><div class="line">                    }</div><div class="line">                });</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_RegisterImageCallBackEx fail! nRet&quot;</span> + nRet);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="comment">// 开始取流</span></div><div class="line">                <span class="comment">// start grab image</span></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga5ee1c63aac34f3d8ea0ea5c2f5f734f2">MV_CC_StartGrabbing</a>(handle);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_StartGrabbing fail! nRet&quot;</span> + nRet);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">                    @Override</div><div class="line">                    <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                        closeDeviceBt.setEnabled(<span class="keyword">true</span>);</div><div class="line">                        openDeviceBt.setEnabled(<span class="keyword">false</span>);</div><div class="line">                    }</div><div class="line">                });</div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                toast(<span class="stringliteral">&quot;Please enumerate the devices first&quot;</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">class </span>CloseDeviceThread <span class="keyword">extends</span> Thread {</div><div class="line">        @Override</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">            super.run();</div><div class="line">            <span class="comment">// 停止取流</span></div><div class="line">            <span class="comment">// end grab image</span></div><div class="line">            <span class="keywordtype">int</span> nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga951784eace474e8a5049c911966c381f">MV_CC_StopGrabbing</a>(handle);</div><div class="line">            <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                showLog(<span class="stringliteral">&quot;MV_CC_StopGrabbing fail! nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            <span class="comment">// 关闭设备</span></div><div class="line">            <span class="comment">// close device</span></div><div class="line">            nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga9200ad9b866b2fc9b8cae94fbba56fde">MV_CC_CloseDevice</a>(handle);</div><div class="line">            <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                showLog(<span class="stringliteral">&quot;MV_CC_CloseDevice fail! nRet &quot;</span> + nRet);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            <span class="comment">// 销毁句柄</span></div><div class="line">            <span class="comment">// destroy handle</span></div><div class="line">            nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga8385105a0abb3a23dc2728ce980656ba">MV_CC_DestroyHandle</a>(handle);</div><div class="line">            <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                showLog(<span class="stringliteral">&quot;MV_CC_DestroyHandle fail! nRet&quot;</span> + nRet);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">                @Override</div><div class="line">                <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                    closeDeviceBt.setEnabled(<span class="keyword">false</span>);</div><div class="line">                    openDeviceBt.setEnabled(<span class="keyword">true</span>);</div><div class="line">                }</div><div class="line">            });</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onDestroy() {</div><div class="line">        super.onDestroy();</div><div class="line">        <span class="keywordflow">if</span> (closeDeviceBt.isEnabled()) {</div><div class="line">            closeDevice();</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="多相机取流"></a>
GrabMultipleCameraActivity.java</h1>
<p>多相机取流</p>
<p>该示例程序说明了如何实现多相机取图。示例中通过创建多个相机句柄handle的方式以区分相机。 </p><div class="fragment"><div class="line"><span class="keyword">package </span>com.example.grabmultiplecamera;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.Button;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.jaredrummler.materialspinner.MaterialSpinner;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.CameraControlException;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControl;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControlDefines;</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> MvCameraControlWrapper.MvCameraControlDefines.MV_OK;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>GrabMultipleCameraActivity <span class="keyword">extends</span> AppCompatActivity {</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">private</span> ArrayList&lt;MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a>&gt; deviceList1 = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">private</span> MaterialSpinner spinner1;</div><div class="line">    TextView logTv1;</div><div class="line">    <span class="keywordtype">int</span> selectNum1 = 0;</div><div class="line">    Button closeDeviceBt1;</div><div class="line">    Button openDeviceBt1;</div><div class="line">    GetOneFrameThread getOneFrameThread1 = <span class="keyword">null</span>;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">private</span> ArrayList&lt;MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a>&gt; deviceList2 = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">private</span> MaterialSpinner spinner2;</div><div class="line">    TextView logTv2;</div><div class="line">    <span class="keywordtype">int</span> selectNum2 = 0;</div><div class="line">    Button closeDeviceBt2;</div><div class="line">    Button openDeviceBt2;</div><div class="line"></div><div class="line">    GetOneFrameThread getOneFrameThread2 = <span class="keyword">null</span>;</div><div class="line"></div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onCreate(Bundle savedInstanceState) {</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_grab_multiple_camera_main);</div><div class="line">        initView();</div><div class="line">        initListener();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initView() {</div><div class="line">        spinner1 = findViewById(R.id.spinner1);</div><div class="line">        logTv1 = findViewById(R.id.logTv1);</div><div class="line">        openDeviceBt1 = findViewById(R.id.openDeviceBt1);</div><div class="line">        closeDeviceBt1 = findViewById(R.id.closeDeviceBt1);</div><div class="line">        spinner1.setOnItemSelectedListener(<span class="keyword">new</span> MaterialSpinner.OnItemSelectedListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onItemSelected(MaterialSpinner view, <span class="keywordtype">int</span> position, <span class="keywordtype">long</span> <span class="keywordtype">id</span>, Object item) {</div><div class="line">                selectNum1 = position;</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        spinner2 = findViewById(R.id.spinner2);</div><div class="line">        logTv2 = findViewById(R.id.logTv2);</div><div class="line">        openDeviceBt2 = findViewById(R.id.openDeviceBt2);</div><div class="line">        closeDeviceBt2 = findViewById(R.id.closeDeviceBt2);</div><div class="line">        spinner2.setOnItemSelectedListener(<span class="keyword">new</span> MaterialSpinner.OnItemSelectedListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onItemSelected(MaterialSpinner view, <span class="keywordtype">int</span> position, <span class="keywordtype">long</span> <span class="keywordtype">id</span>, Object item) {</div><div class="line">                selectNum2 = position;</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initListener() {</div><div class="line">        findViewById(R.id.enumDevicesBt1).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                selectNum1 = 0;</div><div class="line">                deviceList1.clear();</div><div class="line">                spinner1.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    deviceList1 = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga2e162b1972c75982ff1c52e1c5d34a4e">MV_CC_EnumDevices</a>(MvCameraControlDefines.MV_USB_DEVICE | MvCameraControlDefines.MV_GIGE_DEVICE);</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (deviceList1 != <span class="keyword">null</span>) {</div><div class="line">                    <span class="keywordtype">int</span> size = deviceList1.size();</div><div class="line">                    <span class="keywordflow">if</span> (size &gt; 0) {</div><div class="line">                        List&lt;String&gt; deviceName = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++) {</div><div class="line">                            MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a> entity = deviceList1.get(i);</div><div class="line">                            <span class="keywordflow">if</span> (entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines.MV_GIGE_DEVICE) {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a9e8dbdf67802699038b0421c0d311499">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a727f4f765547596fdca29f86a2406dc9">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a0a3a766f998932a02e10e0223b05801c">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#ac0d8c9621aa38cb936f906d981c6a31b">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            } <span class="keywordflow">else</span> {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#ac568233b448c639976fe3280fcc2d0d5">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aeecafd7f0254f5bad432f2323b202700">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#a6b9a01f50a786e68ab65f3ba33079d26">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aac5ebaab488a72e9a7dcb2a5818e33bc">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            }</div><div class="line">                        }</div><div class="line">                        spinner1.setItems(deviceName);</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        spinner1.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">        });</div><div class="line">        findViewById(R.id.enumDevicesBt2).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                selectNum2 = 0;</div><div class="line">                deviceList2.clear();</div><div class="line">                spinner2.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    deviceList2 = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga2e162b1972c75982ff1c52e1c5d34a4e">MV_CC_EnumDevices</a>(MvCameraControlDefines.MV_USB_DEVICE | MvCameraControlDefines.MV_GIGE_DEVICE);</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (deviceList2 != <span class="keyword">null</span>) {</div><div class="line">                    <span class="keywordtype">int</span> size = deviceList2.size();</div><div class="line">                    <span class="keywordflow">if</span> (size &gt; 0) {</div><div class="line">                        List&lt;String&gt; deviceName = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++) {</div><div class="line">                            MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a> entity = deviceList2.get(i);</div><div class="line">                            <span class="keywordflow">if</span> (entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines.MV_GIGE_DEVICE) {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a9e8dbdf67802699038b0421c0d311499">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a727f4f765547596fdca29f86a2406dc9">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a0a3a766f998932a02e10e0223b05801c">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#ac0d8c9621aa38cb936f906d981c6a31b">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            } <span class="keywordflow">else</span> {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#ac568233b448c639976fe3280fcc2d0d5">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aeecafd7f0254f5bad432f2323b202700">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#a6b9a01f50a786e68ab65f3ba33079d26">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aac5ebaab488a72e9a7dcb2a5818e33bc">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            }</div><div class="line">                        }</div><div class="line">                        spinner2.setItems(deviceName);</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        spinner2.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        findViewById(R.id.openDeviceBt1).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                openDevice1();</div><div class="line">            }</div><div class="line">        });</div><div class="line">        findViewById(R.id.closeDeviceBt1).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                closeDevice1();</div><div class="line">            }</div><div class="line">        });</div><div class="line">        findViewById(R.id.openDeviceBt2).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                openDevice2();</div><div class="line">            }</div><div class="line">        });</div><div class="line">        findViewById(R.id.closeDeviceBt2).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                closeDevice2();</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> openDevice1() {</div><div class="line">        <span class="keywordflow">if</span> (getOneFrameThread1 == <span class="keyword">null</span>) {</div><div class="line">            getOneFrameThread1 = <span class="keyword">new</span> GetOneFrameThread(logTv1);</div><div class="line">            getOneFrameThread1.start();</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            <span class="keywordflow">if</span> (!getOneFrameThread1.isAlive()) {</div><div class="line">                getOneFrameThread1.start();</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> openDevice2() {</div><div class="line">        <span class="keywordflow">if</span> (getOneFrameThread2 == <span class="keyword">null</span>) {</div><div class="line">            getOneFrameThread2 = <span class="keyword">new</span> GetOneFrameThread(logTv2);</div><div class="line">            getOneFrameThread2.start();</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            <span class="keywordflow">if</span> (!getOneFrameThread2.isAlive()) {</div><div class="line">                getOneFrameThread2.start();</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> closeDevice1() {</div><div class="line">        <span class="keywordflow">if</span> (getOneFrameThread1 != <span class="keyword">null</span>) {</div><div class="line">            getOneFrameThread1.flag = <span class="keyword">true</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> closeDevice2() {</div><div class="line">        <span class="keywordflow">if</span> (getOneFrameThread2 != <span class="keyword">null</span>) {</div><div class="line">            getOneFrameThread2.flag = <span class="keyword">true</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onDestroy() {</div><div class="line">        super.onDestroy();</div><div class="line">        <span class="keywordflow">if</span> (getOneFrameThread1 != <span class="keyword">null</span>) {</div><div class="line">            getOneFrameThread1.flag = <span class="keyword">true</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">class </span>GetOneFrameThread <span class="keyword">extends</span> Thread {</div><div class="line">        <span class="keywordtype">byte</span>[] datas = <span class="keyword">null</span>;</div><div class="line">        MvCameraControlDefines.Handle handle = <span class="keyword">null</span>;</div><div class="line">        TextView logView;</div><div class="line">        <span class="keywordtype">boolean</span> flag = <span class="keyword">false</span>;</div><div class="line">        MvCameraControlDefines.MV_FRAME_OUT_INFO frameInfo = <span class="keyword">new</span> MvCameraControlDefines.MV_FRAME_OUT_INFO();</div><div class="line">        <span class="keyword">public</span> GetOneFrameThread(TextView logView) {</div><div class="line">            this.logView = logView;</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordtype">void</span> showLog(<span class="keyword">final</span> String str) {</div><div class="line">            <span class="keywordflow">if</span> (logView != <span class="keyword">null</span>) {</div><div class="line">                runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">                    @Override</div><div class="line">                    <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                        <span class="keywordflow">if</span> (logView.getLineCount() &gt; 150) {</div><div class="line">                            logView.setText(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line">                            <span class="keywordflow">return</span>;</div><div class="line">                        }</div><div class="line">                        logView.append(str + <span class="stringliteral">&quot;\n&quot;</span>);</div><div class="line">                        <span class="keywordtype">int</span> offset = logView.getLineCount() * logView.getLineHeight();</div><div class="line">                        <span class="keywordflow">if</span> (offset &gt; logView.getHeight()) {</div><div class="line">                            logView.scrollTo(0, offset - logView.getHeight());</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                });</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line">        @Override</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">            super.run();</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (deviceList1 != <span class="keyword">null</span> &amp;&amp; deviceList1.size() &gt; 0) {</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    handle = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#gae94fdee0967a330a197b783c781e36fb">MV_CC_CreateHandle</a>(deviceList1.get(selectNum1));</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (handle == <span class="keyword">null</span>) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;CreateHandle fail! nRet&quot;</span>);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordtype">int</span> nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga4e982ac1afd05dec95710ac2adcb6c6a">MV_CC_OpenDevice</a>(handle);</div><div class="line">                <span class="keywordflow">if</span> (nRet != 0) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;OpenDevice fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line"></div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (deviceList1.get(selectNum1).<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines.MV_GIGE_DEVICE) {</div><div class="line">                    <span class="keywordtype">int</span> nPacketSize = MvCameraControl.MV_CC_GetOptimalPacketSize(handle);</div><div class="line">                    <span class="keywordflow">if</span> (nPacketSize &gt; 0) {</div><div class="line">                        nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga8932770d409766b20cc6819b6d48733f">MV_CC_SetIntValue</a>(handle, <span class="stringliteral">&quot;GevSCPSPacketSize&quot;</span>, nPacketSize);</div><div class="line">                        <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                            showLog(<span class="stringliteral">&quot;Warning: Set Packet Size fail nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">                            <span class="keywordflow">return</span>;</div><div class="line">                        }</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        showLog(<span class="stringliteral">&quot;Warning: Get Packet Size fail nRet&quot;</span> + Integer.toHexString(nPacketSize));</div><div class="line">                    }</div><div class="line">                }</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga69d2f77efcabbdf57be21ab9465ee70f">MV_CC_SetEnumValue</a>(handle, <span class="stringliteral">&quot;TriggerMode&quot;</span>, 0);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_SetTriggerMode fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                Integer width = <span class="keyword">new</span> Integer(0);</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga44cb71a1f783fef852b51c1405560ce1">MV_CC_GetIntValue</a>(handle, <span class="stringliteral">&quot;Width&quot;</span>, width);</div><div class="line">                <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;GetWidth fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                Integer height = <span class="keyword">new</span> Integer(0);</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga44cb71a1f783fef852b51c1405560ce1">MV_CC_GetIntValue</a>(handle, <span class="stringliteral">&quot;Height&quot;</span>, height);</div><div class="line">                <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;GetHeight fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                datas = <span class="keyword">new</span> <span class="keywordtype">byte</span>[width * height * 3];</div><div class="line">                <span class="comment">// start grab image</span></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga5ee1c63aac34f3d8ea0ea5c2f5f734f2">MV_CC_StartGrabbing</a>(handle);</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_StartGrabbing fail! nRet&quot;</span> + nRet);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line">                    <span class="keywordflow">if</span> (flag) {</div><div class="line">                        <span class="comment">// 停止取流</span></div><div class="line">                        <span class="comment">// end grab image</span></div><div class="line">                        nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga951784eace474e8a5049c911966c381f">MV_CC_StopGrabbing</a>(handle);</div><div class="line">                        <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                            showLog(<span class="stringliteral">&quot;MV_CC_StopGrabbing fail! nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">                        }</div><div class="line">                        <span class="comment">// 关闭设备</span></div><div class="line">                        <span class="comment">// close device</span></div><div class="line">                        nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga9200ad9b866b2fc9b8cae94fbba56fde">MV_CC_CloseDevice</a>(handle);</div><div class="line">                        <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                            showLog(<span class="stringliteral">&quot;MV_CC_CloseDevice fail! nRet &quot;</span> + nRet);</div><div class="line">                        }</div><div class="line">                        <span class="comment">// 销毁句柄</span></div><div class="line">                        <span class="comment">// destroy handle</span></div><div class="line">                        nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga8385105a0abb3a23dc2728ce980656ba">MV_CC_DestroyHandle</a>(handle);</div><div class="line">                        <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                            showLog(<span class="stringliteral">&quot;MV_CC_DestroyHandle fail! nRet&quot;</span> + nRet);</div><div class="line">                        }</div><div class="line">                        <span class="keywordflow">return</span>;</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        <span class="keywordtype">int</span> nRet1 = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#gae1a51a885f885902d8783e1237556e48">MV_CC_GetOneFrameTimeout</a>(handle, datas, frameInfo, 1000);</div><div class="line">                        <span class="keywordflow">if</span> (nRet1 == MV_OK) {</div><div class="line">                            showLog(<span class="stringliteral">&quot;GetOneFrame, Width:&quot;</span> + frameInfo.width +</div><div class="line">                                    <span class="stringliteral">&quot;Height:&quot;</span> + frameInfo.height +</div><div class="line">                                    <span class="stringliteral">&quot;nFrameNum&quot;</span> + frameInfo.frameNum);</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                showLog(<span class="stringliteral">&quot;Please enumerate the devices first&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="图像处理"></a>
ImageProcessActivity.java</h1>
<p>图像处理</p>
<p>该示例程序说明了如何实现图像像素格式转换和图像保存两个功能。在获取到图像数据后可以使用 <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#ga1fe9e6e6ff70a7602137c7c9ee8a3490" title="像素格式转换">MV_CC_ConvertPixelType()</a> 进行数据格式转换，使用 MV_CC_SaveImageEx2() 进行图像保存。 </p><div class="fragment"><div class="line"><span class="keyword">package </span>com.example.imageprocess;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.text.method.ScrollingMovementMethod;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.EditText;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.FileUtils;</div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.IMainView;</div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.LogView;</div><div class="line"><span class="keyword">import</span> com.jaredrummler.materialspinner.MaterialSpinner;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.CameraControlException;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControl;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControlDefines;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>ImageProcessActivity <span class="keyword">extends</span> AppCompatActivity implements View.OnClickListener, IMainView {</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ArrayList&lt;MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a>&gt; deviceList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">private</span> MaterialSpinner spinner;</div><div class="line">    <span class="keywordtype">int</span> selectNum = 0;</div><div class="line">    EditText logTv;</div><div class="line">    ProcessThread processThread = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onCreate(Bundle savedInstanceState) {</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_image_process);</div><div class="line">        findViewById(R.id.convertPixelTypeBt).setOnClickListener(<span class="keyword">this</span>);</div><div class="line">        initView();</div><div class="line">        initListener();</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">        <span class="keywordflow">switch</span> (v.getId()) {</div><div class="line">            <span class="keywordflow">case</span> R.id.convertPixelTypeBt: {</div><div class="line">                convertPixelType();</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initView() {</div><div class="line">        logTv = findViewById(R.id.logTv);</div><div class="line">        logTv.setMovementMethod(ScrollingMovementMethod.getInstance());</div><div class="line">        spinner = findViewById(R.id.spinner);</div><div class="line">        spinner.setOnItemSelectedListener(<span class="keyword">new</span> MaterialSpinner.OnItemSelectedListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onItemSelected(MaterialSpinner view, <span class="keywordtype">int</span> position, <span class="keywordtype">long</span> <span class="keywordtype">id</span>, Object item) {</div><div class="line">                selectNum = position;</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initListener() {</div><div class="line">        findViewById(R.id.enumDevicesBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                selectNum = 0;</div><div class="line">                deviceList.clear();</div><div class="line">                spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    deviceList = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga2e162b1972c75982ff1c52e1c5d34a4e">MV_CC_EnumDevices</a>(MvCameraControlDefines.MV_USB_DEVICE | MvCameraControlDefines.MV_GIGE_DEVICE);</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (deviceList != <span class="keyword">null</span>) {</div><div class="line">                    <span class="keywordtype">int</span> size = deviceList.size();</div><div class="line">                    <span class="keywordflow">if</span> (size &gt; 0) {</div><div class="line">                        List&lt;String&gt; deviceName = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++) {</div><div class="line">                            MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a> entity = deviceList.get(i);</div><div class="line">                            <span class="keywordflow">if</span> (entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines.MV_GIGE_DEVICE) {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a9e8dbdf67802699038b0421c0d311499">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a727f4f765547596fdca29f86a2406dc9">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a0a3a766f998932a02e10e0223b05801c">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#ac0d8c9621aa38cb936f906d981c6a31b">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            } <span class="keywordflow">else</span> {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#ac568233b448c639976fe3280fcc2d0d5">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aeecafd7f0254f5bad432f2323b202700">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#a6b9a01f50a786e68ab65f3ba33079d26">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aac5ebaab488a72e9a7dcb2a5818e33bc">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            }</div><div class="line">                        }</div><div class="line">                        spinner.setItems(deviceName);</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                    }</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Not enumerated to device&quot;</span>);</div><div class="line">                }</div><div class="line">            }</div><div class="line"></div><div class="line">        });</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> showLog(<span class="keyword">final</span> String str) {</div><div class="line">        LogView.showLog(<span class="keyword">this</span>,logTv,str);</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateButton(<span class="keywordtype">int</span> state) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateImage(<span class="keywordtype">byte</span>[] data) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> convertPixelType() {</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (processThread == <span class="keyword">null</span>) {</div><div class="line">            processThread = <span class="keyword">new</span> ProcessThread();</div><div class="line">            processThread.start();</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            <span class="keywordflow">if</span> (!processThread.isAlive()) {</div><div class="line">                processThread.start();</div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                showLog(<span class="stringliteral">&quot;Please try later&quot;</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line"></div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">class </span>ProcessThread <span class="keyword">extends</span> Thread {</div><div class="line">        @Override</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">            super.run();</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (deviceList.size() == 0) {</div><div class="line">                showLog(<span class="stringliteral">&quot;Please enumerate the devices first&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            MvCameraControlDefines.Handle handle = <span class="keyword">null</span>;</div><div class="line">            <span class="keywordflow">try</span> {</div><div class="line">                handle = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#gae94fdee0967a330a197b783c781e36fb">MV_CC_CreateHandle</a>(deviceList.get(selectNum));</div><div class="line"></div><div class="line">            } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                e.printStackTrace();</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span> (handle == <span class="keyword">null</span>) {</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="comment">//bayerrg8</span></div><div class="line">            MvCameraControlDefines. <a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html">MV_CC_PIXEL_CONVERT_PARAM</a> param = <span class="keyword">new</span> MvCameraControlDefines. <a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html">MV_CC_PIXEL_CONVERT_PARAM</a>();</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ae09deb5879bd5f4385ca4a42a7981b58">width</a> = 1024;</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a020968a512e3fb0641a99c01908dfbdf">height</a> = 1024;</div><div class="line">            param.srcPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_BayerRG8;</div><div class="line">            param.dstPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_RGB8_Packed;</div><div class="line"></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a> = FileUtils.getFromRaw(ImageProcessActivity.this, R.raw.bayerrg8); <span class="comment">//mono</span></div><div class="line"></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a> = param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a>.length;</div><div class="line">            Log.e(<span class="stringliteral">&quot;param.nSrcDataLen&quot;</span>, <span class="stringliteral">&quot;param.nSrcDataLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a>);</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a> = <span class="keyword">new</span> <span class="keywordtype">byte</span>[1024 * 1024 * 4];</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a> = 0;</div><div class="line">            param.dstBufferSize = 1024 * 1024 * 4;</div><div class="line">            <span class="keywordtype">int</span> nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#ga1fe9e6e6ff70a7602137c7c9ee8a3490">MV_CC_ConvertPixelType</a>(handle, param);</div><div class="line">            <span class="keywordflow">if</span> (nRet == 0) {</div><div class="line">                Log.e(<span class="stringliteral">&quot;Conversion succeeded&quot;</span>, <span class="stringliteral">&quot;param.nDstLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a>);</div><div class="line">            }</div><div class="line">            showLog(<span class="stringliteral">&quot;ConvertPixelType:nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">            FileUtils.createFileWithByte(param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a>, <span class="stringliteral">&quot;bayerrg8toRgb&quot;</span>);</div><div class="line"></div><div class="line">            <span class="comment">//bayerrg10</span></div><div class="line">            param = <span class="keyword">new</span> MvCameraControlDefines. <a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html">MV_CC_PIXEL_CONVERT_PARAM</a>();</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ae09deb5879bd5f4385ca4a42a7981b58">width</a> = 1024;</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a020968a512e3fb0641a99c01908dfbdf">height</a> = 1024;</div><div class="line">            param.srcPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_BayerRG10;</div><div class="line">            param.dstPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_RGB8_Packed;</div><div class="line">            <span class="comment">//获取raw 文件夹中源数据</span></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a> = FileUtils.getFromRaw(ImageProcessActivity.this, R.raw.bayerrg10); <span class="comment">//mono</span></div><div class="line"></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a> = param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a>.length;</div><div class="line">            Log.e(<span class="stringliteral">&quot;param.nSrcDataLen&quot;</span>, <span class="stringliteral">&quot;param.nSrcDataLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a>);</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a> = <span class="keyword">new</span> <span class="keywordtype">byte</span>[1024 * 1024 * 4];</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a> = 0;</div><div class="line">            param.dstBufferSize = 1024 * 1024 * 4;</div><div class="line">            nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#ga1fe9e6e6ff70a7602137c7c9ee8a3490">MV_CC_ConvertPixelType</a>(handle, param);</div><div class="line">            <span class="keywordflow">if</span> (nRet == 0) {</div><div class="line">                Log.e(<span class="stringliteral">&quot;Conversion succeeded&quot;</span>, <span class="stringliteral">&quot;param.nDstLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a>);</div><div class="line">            }</div><div class="line">            showLog(<span class="stringliteral">&quot;ConvertPixelType:nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">            FileUtils.createFileWithByte(param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a>, <span class="stringliteral">&quot;BayerRG10toRgb&quot;</span>);</div><div class="line"></div><div class="line"></div><div class="line">            <span class="comment">//bayerrg10packed</span></div><div class="line">            param = <span class="keyword">new</span> MvCameraControlDefines. <a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html">MV_CC_PIXEL_CONVERT_PARAM</a>();</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ae09deb5879bd5f4385ca4a42a7981b58">width</a> = 1024;</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a020968a512e3fb0641a99c01908dfbdf">height</a> = 1024;</div><div class="line">            param.srcPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_BayerRG10_Packed;</div><div class="line">            param.dstPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_RGB8_Packed;</div><div class="line"></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a> = FileUtils.getFromRaw(ImageProcessActivity.this, R.raw.bayerrg10packed); <span class="comment">//mono</span></div><div class="line"></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a> = param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a>.length;</div><div class="line">            Log.e(<span class="stringliteral">&quot;param.nSrcDataLen&quot;</span>, <span class="stringliteral">&quot;param.nSrcDataLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a>);</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a> = <span class="keyword">new</span> <span class="keywordtype">byte</span>[1024 * 1024 * 4];</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a> = 0;</div><div class="line">            param.dstBufferSize = 1024 * 1024 * 4;</div><div class="line">            nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#ga1fe9e6e6ff70a7602137c7c9ee8a3490">MV_CC_ConvertPixelType</a>(handle, param);</div><div class="line">            <span class="keywordflow">if</span> (nRet == 0) {</div><div class="line">                Log.e(<span class="stringliteral">&quot;Conversion succeeded&quot;</span>, <span class="stringliteral">&quot;param.nDstLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a>);</div><div class="line">            }</div><div class="line">            showLog(<span class="stringliteral">&quot;ConvertPixelType:nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">            FileUtils.createFileWithByte(param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a>, <span class="stringliteral">&quot;BayerRG10PackedtoRgb&quot;</span>);</div><div class="line"></div><div class="line"></div><div class="line">            <span class="comment">//bayerrg12</span></div><div class="line">            param = <span class="keyword">new</span> MvCameraControlDefines. <a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html">MV_CC_PIXEL_CONVERT_PARAM</a>();</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ae09deb5879bd5f4385ca4a42a7981b58">width</a> = 1024;</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a020968a512e3fb0641a99c01908dfbdf">height</a> = 1024;</div><div class="line">            param.srcPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_BayerRG12;</div><div class="line">            param.dstPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_RGB8_Packed;</div><div class="line"></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a> = FileUtils.getFromRaw(ImageProcessActivity.this, R.raw.bayerrg12); <span class="comment">//mono</span></div><div class="line"></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a> = param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a>.length;</div><div class="line">            Log.e(<span class="stringliteral">&quot;param.nSrcDataLen&quot;</span>, <span class="stringliteral">&quot;param.nSrcDataLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a>);</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a> = <span class="keyword">new</span> <span class="keywordtype">byte</span>[1024 * 1024 * 4];</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a> = 0;</div><div class="line">            param.dstBufferSize = 1024 * 1024 * 4;</div><div class="line">            nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#ga1fe9e6e6ff70a7602137c7c9ee8a3490">MV_CC_ConvertPixelType</a>(handle, param);</div><div class="line">            <span class="keywordflow">if</span> (nRet == 0) {</div><div class="line">                Log.e(<span class="stringliteral">&quot;Conversion succeeded&quot;</span>, <span class="stringliteral">&quot;param.nDstLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a>);</div><div class="line">            }</div><div class="line">            showLog(<span class="stringliteral">&quot;ConvertPixelType:nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">            FileUtils.createFileWithByte(param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a>, <span class="stringliteral">&quot;BayerRG12toRgb&quot;</span>);</div><div class="line"></div><div class="line"></div><div class="line">            <span class="comment">//bayerrg12</span></div><div class="line">            param = <span class="keyword">new</span> MvCameraControlDefines. <a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html">MV_CC_PIXEL_CONVERT_PARAM</a>();</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ae09deb5879bd5f4385ca4a42a7981b58">width</a> = 1024;</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a020968a512e3fb0641a99c01908dfbdf">height</a> = 1024;</div><div class="line">            param.srcPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_BayerRG12_Packed;</div><div class="line">            param.dstPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_RGB8_Packed;</div><div class="line"></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a> = FileUtils.getFromRaw(ImageProcessActivity.this, R.raw.bayerrg12packed); <span class="comment">//mono</span></div><div class="line"></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a> = param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a>.length;</div><div class="line">            Log.e(<span class="stringliteral">&quot;param.nSrcDataLen&quot;</span>, <span class="stringliteral">&quot;param.nSrcDataLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a>);</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a> = <span class="keyword">new</span> <span class="keywordtype">byte</span>[1024 * 1024 * 4];</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a> = 0;</div><div class="line">            param.dstBufferSize = 1024 * 1024 * 4;</div><div class="line">            nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#ga1fe9e6e6ff70a7602137c7c9ee8a3490">MV_CC_ConvertPixelType</a>(handle, param);</div><div class="line">            <span class="keywordflow">if</span> (nRet == 0) {</div><div class="line">                Log.e(<span class="stringliteral">&quot;Conversion succeeded&quot;</span>, <span class="stringliteral">&quot;param.nDstLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a>);</div><div class="line">            }</div><div class="line">            showLog(<span class="stringliteral">&quot;ConvertPixelType:nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">            FileUtils.createFileWithByte(param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a>, <span class="stringliteral">&quot;bayerrg12packedtoRgb&quot;</span>);</div><div class="line"></div><div class="line"></div><div class="line">            <span class="comment">//bayerrg12</span></div><div class="line">            param = <span class="keyword">new</span> MvCameraControlDefines. <a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html">MV_CC_PIXEL_CONVERT_PARAM</a>();</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ae09deb5879bd5f4385ca4a42a7981b58">width</a> = 1024;</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a020968a512e3fb0641a99c01908dfbdf">height</a> = 1024;</div><div class="line">            param.srcPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_Mono8;</div><div class="line">            param.dstPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_RGB8_Packed;</div><div class="line"></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a> = FileUtils.getFromRaw(ImageProcessActivity.this, R.raw.mono8); <span class="comment">//mono</span></div><div class="line"></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a> = param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a>.length;</div><div class="line">            Log.e(<span class="stringliteral">&quot;param.nSrcDataLen&quot;</span>, <span class="stringliteral">&quot;param.nSrcDataLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a>);</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a> = <span class="keyword">new</span> <span class="keywordtype">byte</span>[1024 * 1024 * 4];</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a> = 0;</div><div class="line">            param.dstBufferSize = 1024 * 1024 * 4;</div><div class="line">            nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#ga1fe9e6e6ff70a7602137c7c9ee8a3490">MV_CC_ConvertPixelType</a>(handle, param);</div><div class="line">            <span class="keywordflow">if</span> (nRet == 0) {</div><div class="line">                Log.e(<span class="stringliteral">&quot;Conversion succeeded&quot;</span>, <span class="stringliteral">&quot;param.nDstLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a>);</div><div class="line">            }</div><div class="line">            showLog(<span class="stringliteral">&quot;ConvertPixelType:nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">            FileUtils.createFileWithByte(param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a>, <span class="stringliteral">&quot;mono8toRgb&quot;</span>);</div><div class="line"></div><div class="line"></div><div class="line">            param = <span class="keyword">new</span> MvCameraControlDefines.MV_CC_PIXEL_CONVERT_PARAM();</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ae09deb5879bd5f4385ca4a42a7981b58">width</a> = 1024;</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a020968a512e3fb0641a99c01908dfbdf">height</a> = 1024;</div><div class="line">            param.srcPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_Mono10;</div><div class="line">            param.dstPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_RGB8_Packed;</div><div class="line"></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a> = FileUtils.getFromRaw(ImageProcessActivity.this, R.raw.mono10); <span class="comment">//mono</span></div><div class="line"></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a> = param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a>.length;</div><div class="line">            Log.e(<span class="stringliteral">&quot;param.nSrcDataLen&quot;</span>, <span class="stringliteral">&quot;param.nSrcDataLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a>);</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a> = <span class="keyword">new</span> <span class="keywordtype">byte</span>[1024 * 1024 * 4];</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a> = 0;</div><div class="line">            param.dstBufferSize = 1024 * 1024 * 4;</div><div class="line">            nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#ga1fe9e6e6ff70a7602137c7c9ee8a3490">MV_CC_ConvertPixelType</a>(handle, param);</div><div class="line">            <span class="keywordflow">if</span> (nRet == 0) {</div><div class="line">                Log.e(<span class="stringliteral">&quot;Conversion succeeded&quot;</span>, <span class="stringliteral">&quot;param.nDstLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a>);</div><div class="line">            }</div><div class="line">            showLog(<span class="stringliteral">&quot;ConvertPixelType:nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">            FileUtils.createFileWithByte(param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a>, <span class="stringliteral">&quot;mono10toRgb&quot;</span>);</div><div class="line"></div><div class="line"></div><div class="line">            param = <span class="keyword">new</span> MvCameraControlDefines. <a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html">MV_CC_PIXEL_CONVERT_PARAM</a>();</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ae09deb5879bd5f4385ca4a42a7981b58">width</a> = 1024;</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a020968a512e3fb0641a99c01908dfbdf">height</a> = 1024;</div><div class="line">            param.srcPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_Mono10_Packed;</div><div class="line">            param.dstPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_RGB8_Packed;</div><div class="line"></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a> = FileUtils.getFromRaw(ImageProcessActivity.this, R.raw.mono10packed); <span class="comment">//mono</span></div><div class="line"></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a> = param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a>.length;</div><div class="line">            Log.e(<span class="stringliteral">&quot;param.nSrcDataLen&quot;</span>, <span class="stringliteral">&quot;param.nSrcDataLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a>);</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a> = <span class="keyword">new</span> <span class="keywordtype">byte</span>[1024 * 1024 * 4];</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a> = 0;</div><div class="line">            param.dstBufferSize = 1024 * 1024 * 4;</div><div class="line">            nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#ga1fe9e6e6ff70a7602137c7c9ee8a3490">MV_CC_ConvertPixelType</a>(handle, param);</div><div class="line">            <span class="keywordflow">if</span> (nRet == 0) {</div><div class="line">                Log.e(<span class="stringliteral">&quot;Conversion succeeded&quot;</span>, <span class="stringliteral">&quot;param.nDstLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a>);</div><div class="line">            }</div><div class="line">            showLog(<span class="stringliteral">&quot;ConvertPixelType:nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">            FileUtils.createFileWithByte(param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a>, <span class="stringliteral">&quot;mono10packedtoRgb&quot;</span>);</div><div class="line"></div><div class="line"></div><div class="line">            param = <span class="keyword">new</span> MvCameraControlDefines. <a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html">MV_CC_PIXEL_CONVERT_PARAM</a>();</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ae09deb5879bd5f4385ca4a42a7981b58">width</a> = 1024;</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a020968a512e3fb0641a99c01908dfbdf">height</a> = 1024;</div><div class="line">            param.srcPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_Mono12;</div><div class="line">            param.dstPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_RGB8_Packed;</div><div class="line"></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a> = FileUtils.getFromRaw(ImageProcessActivity.this, R.raw.mono12); <span class="comment">//mono</span></div><div class="line"></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a> = param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a>.length;</div><div class="line">            Log.e(<span class="stringliteral">&quot;param.nSrcDataLen&quot;</span>, <span class="stringliteral">&quot;param.nSrcDataLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a>);</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a> = <span class="keyword">new</span> <span class="keywordtype">byte</span>[1024 * 1024 * 4];</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a> = 0;</div><div class="line">            param.dstBufferSize = 1024 * 1024 * 4;</div><div class="line">            nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#ga1fe9e6e6ff70a7602137c7c9ee8a3490">MV_CC_ConvertPixelType</a>(handle, param);</div><div class="line">            <span class="keywordflow">if</span> (nRet == 0) {</div><div class="line">                Log.e(<span class="stringliteral">&quot;Conversion succeeded&quot;</span>, <span class="stringliteral">&quot;param.nDstLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a>);</div><div class="line">            }</div><div class="line">            showLog(<span class="stringliteral">&quot;ConvertPixelType:nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">            FileUtils.createFileWithByte(param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a>, <span class="stringliteral">&quot;mono12toRgb&quot;</span>);</div><div class="line"></div><div class="line"></div><div class="line">            param = <span class="keyword">new</span> MvCameraControlDefines. <a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html">MV_CC_PIXEL_CONVERT_PARAM</a>();</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ae09deb5879bd5f4385ca4a42a7981b58">width</a> = 1024;</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a020968a512e3fb0641a99c01908dfbdf">height</a> = 1024;</div><div class="line">            param.srcPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_Mono12_Packed;</div><div class="line">            param.dstPixelType = MvCameraControlDefines.MvGvspPixelType.PixelType_Gvsp_RGB8_Packed;</div><div class="line"></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a> = FileUtils.getFromRaw(ImageProcessActivity.this, R.raw.mono12packed); <span class="comment">//mono</span></div><div class="line"></div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a> = param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#ad0b6f14a19b3e7d7a065224f04983e72">srcData</a>.length;</div><div class="line">            Log.e(<span class="stringliteral">&quot;param.nSrcDataLen&quot;</span>, <span class="stringliteral">&quot;param.nSrcDataLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#aa7d20b7bc7236df2c17d9a4831b1e202">srcDataLen</a>);</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a> = <span class="keyword">new</span> <span class="keywordtype">byte</span>[1024 * 1024 * 4];</div><div class="line">            param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a> = 0;</div><div class="line">            param.dstBufferSize = 1024 * 1024 * 4;</div><div class="line">            nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE5_xA4_x84_xE7_x90_x86.html#ga1fe9e6e6ff70a7602137c7c9ee8a3490">MV_CC_ConvertPixelType</a>(handle, param);</div><div class="line">            <span class="keywordflow">if</span> (nRet == 0) {</div><div class="line">                Log.e(<span class="stringliteral">&quot;Conversion succeeded&quot;</span>, <span class="stringliteral">&quot;param.nDstLen&quot;</span> + param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a2690984acf43e74040a9c1db7e7f7b00">dstLen</a>);</div><div class="line">            }</div><div class="line">            showLog(<span class="stringliteral">&quot;ConvertPixelType:nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">            FileUtils.createFileWithByte(param.<a class="code" href="class_m_v___c_c___p_i_x_e_l___c_o_n_v_e_r_t___p_a_r_a_m.html#a180d2f601d0f8b1d0f8fd2a3e7340bb5">dstBuffer</a>, <span class="stringliteral">&quot;mono12packedtoRgb&quot;</span>);</div><div class="line">            MvCameraControl.MV_CC_DestroyHandle(handle);</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="相机重连"></a>
ReconnectActivity.java</h1>
<p>相机重连</p>
<p>该示例程序说明了相机掉线后，心跳时间内重新连接后的操作，通过在打开相机后注册异常回调函数来监测相机掉线异常状态。重连后先进行停止取流、关闭设备、销毁句柄操作后重新连接相机。 </p><div class="fragment"><div class="line"><span class="keyword">package </span>com.example.reconnect;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.text.method.ScrollingMovementMethod;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.Button;</div><div class="line"><span class="keyword">import</span> android.widget.EditText;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.IMainView;</div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.LogView;</div><div class="line"><span class="keyword">import</span> com.jaredrummler.materialspinner.MaterialSpinner;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.CameraControlException;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.CameraExceptionCallBack;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.CameraImageCallBack;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControl;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControlDefines;</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> MvCameraControlWrapper.MvCameraControlDefines.MV_GIGE_DEVICE;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> MvCameraControlWrapper.MvCameraControlDefines.MV_OK;</div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> MvCameraControlWrapper.MvCameraControlDefines.MV_USB_DEVICE;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>ReconnectActivity <span class="keyword">extends</span> AppCompatActivity implements IMainView {</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ArrayList&lt;MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a>&gt; deviceList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">private</span> MaterialSpinner spinner;</div><div class="line">    EditText logTv;</div><div class="line">    <span class="keywordtype">int</span> selectNum = 0;</div><div class="line">    Button closeDeviceBt;</div><div class="line">    Button openDeviceBt;</div><div class="line">    Button enumDevicesBt;</div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">boolean</span> isConnect = <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">private</span> ReconnectThread reconnectThread;</div><div class="line">    <span class="keyword">private</span> String strSerialNumber = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line">    <span class="keyword">private</span> <a class="code" href="group___xE5_x9B_x9E_xE8_xB0_x83_xE5_x87_xBD_xE6_x95_xB0.html#ga50e74582c858f06989e7c1133a7be0e5">CameraExceptionCallBack</a> cameraExceptionCallBack = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">private</span> <a class="code" href="group___xE5_x9B_x9E_xE8_xB0_x83_xE5_x87_xBD_xE6_x95_xB0.html#gad8559ccfcfe48b541d40b440a63ef641">CameraImageCallBack</a> cameraImageCallBack = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">private</span> OpenDeviceThread openDeviceThread = <span class="keyword">null</span>;</div><div class="line">    <span class="keyword">private</span> CloseDeviceThread closeDeviceThread = <span class="keyword">null</span>;</div><div class="line">    MvCameraControlDefines.Handle handle = <span class="keyword">null</span>;</div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onCreate(Bundle savedInstanceState) {</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_reconnect_main);</div><div class="line">        initView();</div><div class="line">        initListener();</div><div class="line">        cameraExceptionCallBack = <span class="keyword">new</span> <a class="code" href="group___xE5_x9B_x9E_xE8_xB0_x83_xE5_x87_xBD_xE6_x95_xB0.html#ga50e74582c858f06989e7c1133a7be0e5">CameraExceptionCallBack</a>() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">int</span> OnExceptionCallBack(<span class="keywordtype">int</span> i) {</div><div class="line">                showLog(<span class="stringliteral">&quot;cameraExceptionCallBack&quot;</span>);</div><div class="line">                isConnect = <span class="keyword">false</span>;</div><div class="line">                <span class="keywordflow">if</span> (reconnectThread == <span class="keyword">null</span>) {</div><div class="line">                    reconnectThread = <span class="keyword">new</span> ReconnectThread();</div><div class="line">                    reconnectThread.start();</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    reconnectThread.start();</div><div class="line">                }</div><div class="line">                <span class="keywordflow">return</span> 0;</div><div class="line">            }</div><div class="line">        };</div><div class="line">        cameraImageCallBack = <span class="keyword">new</span> <a class="code" href="group___xE5_x9B_x9E_xE8_xB0_x83_xE5_x87_xBD_xE6_x95_xB0.html#gad8559ccfcfe48b541d40b440a63ef641">CameraImageCallBack</a>() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">int</span> OnImageCallBack(<span class="keywordtype">byte</span>[] bytes, MvCameraControlDefines.MV_FRAME_OUT_INFO mv_frame_out_info) {</div><div class="line">                showLog(<span class="stringliteral">&quot;GetOneFrame, Width:&quot;</span> + mv_frame_out_info.width +</div><div class="line">                        <span class="stringliteral">&quot;Height:&quot;</span> + mv_frame_out_info.height +</div><div class="line">                        <span class="stringliteral">&quot;nFrameNum&quot;</span> + mv_frame_out_info.frameNum);</div><div class="line">                <span class="keywordflow">return</span> 0;</div><div class="line">            }</div><div class="line">        };</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initView() {</div><div class="line">        spinner = findViewById(R.id.spinner);</div><div class="line">        logTv = findViewById(R.id.logTv);</div><div class="line">        logTv.setMovementMethod(ScrollingMovementMethod.getInstance());</div><div class="line">        openDeviceBt = findViewById(R.id.openDeviceBt);</div><div class="line">        closeDeviceBt = findViewById(R.id.closeDeviceBt);</div><div class="line">        enumDevicesBt = findViewById(R.id.enumDevicesBt);</div><div class="line">        enumDevicesBt = findViewById(R.id.enumDevicesBt);</div><div class="line">        spinner.setOnItemSelectedListener(<span class="keyword">new</span> MaterialSpinner.OnItemSelectedListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onItemSelected(MaterialSpinner view, <span class="keywordtype">int</span> position, <span class="keywordtype">long</span> <span class="keywordtype">id</span>, Object item) {</div><div class="line">                selectNum = position;</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initListener() {</div><div class="line"></div><div class="line">        enumDevicesBt.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                selectNum = 0;</div><div class="line">                deviceList.clear();</div><div class="line">                spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    deviceList = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga2e162b1972c75982ff1c52e1c5d34a4e">MV_CC_EnumDevices</a>(MvCameraControlDefines.MV_USB_DEVICE | MvCameraControlDefines.MV_GIGE_DEVICE);</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (deviceList != <span class="keyword">null</span>) {</div><div class="line">                    <span class="keywordtype">int</span> size = deviceList.size();</div><div class="line">                    <span class="keywordflow">if</span> (size &gt; 0) {</div><div class="line">                        List&lt;String&gt; deviceName = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++) {</div><div class="line">                            MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a> entity = deviceList.get(i);</div><div class="line">                            <span class="keywordflow">if</span> (entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines.MV_GIGE_DEVICE) {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a9e8dbdf67802699038b0421c0d311499">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a727f4f765547596fdca29f86a2406dc9">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a0a3a766f998932a02e10e0223b05801c">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#ac0d8c9621aa38cb936f906d981c6a31b">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            } <span class="keywordflow">else</span> {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#ac568233b448c639976fe3280fcc2d0d5">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aeecafd7f0254f5bad432f2323b202700">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#a6b9a01f50a786e68ab65f3ba33079d26">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aac5ebaab488a72e9a7dcb2a5818e33bc">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            }</div><div class="line">                        }</div><div class="line">                        spinner.setItems(deviceName);</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                    }</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Not enumerated to device&quot;</span>);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        findViewById(R.id.openDeviceBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                openDevice();</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        findViewById(R.id.closeDeviceBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                closeDevice();</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> showLog(<span class="keyword">final</span> String str) {</div><div class="line">        LogView.showLog(<span class="keyword">this</span>,logTv,str);</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateButton(<span class="keywordtype">int</span> state) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateImage(<span class="keywordtype">byte</span>[] data) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> toast(<span class="keyword">final</span> String <span class="keywordtype">string</span>) {</div><div class="line">        runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                Toast.makeText(ReconnectActivity.this, <span class="keywordtype">string</span>, Toast.LENGTH_SHORT).show();</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> openDevice() {</div><div class="line">        enumBtSetEnabled(<span class="keyword">false</span>);</div><div class="line">        <span class="keywordflow">if</span> (openDeviceThread == <span class="keyword">null</span>) {</div><div class="line">            openDeviceThread = <span class="keyword">new</span> OpenDeviceThread();</div><div class="line">            openDeviceThread.start();</div><div class="line"></div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            <span class="keywordflow">if</span> (!openDeviceThread.isAlive()) {</div><div class="line">                openDeviceThread.start();</div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                showLog(<span class="stringliteral">&quot;Please try later&quot;</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> closeDevice() {</div><div class="line">        <span class="keywordflow">if</span> (closeDeviceThread == <span class="keyword">null</span>) {</div><div class="line">            closeDeviceThread = <span class="keyword">new</span> CloseDeviceThread();</div><div class="line">            closeDeviceThread.start();</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            <span class="keywordflow">if</span> (!closeDeviceThread.isAlive()) {</div><div class="line">                closeDeviceThread.start();</div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                showLog(<span class="stringliteral">&quot;Please try later&quot;</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onDestroy() {</div><div class="line">        super.onDestroy();</div><div class="line">        <span class="keywordflow">if</span> (closeDeviceBt.isEnabled()) {</div><div class="line">            closeDevice();</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">class </span>OpenDeviceThread <span class="keyword">extends</span> Thread {</div><div class="line">        @Override</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">            super.run();</div><div class="line">            <span class="keywordflow">if</span> (deviceList != <span class="keyword">null</span> &amp;&amp; deviceList.size() &gt; 0) {</div><div class="line">                MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a> info = deviceList.get(selectNum);</div><div class="line">                <span class="keywordflow">if</span> (info.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MV_GIGE_DEVICE) {</div><div class="line">                    strSerialNumber = info.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a727f4f765547596fdca29f86a2406dc9">serialNumber</a>;</div><div class="line">                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (info.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MV_USB_DEVICE) {</div><div class="line">                    strSerialNumber = info.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aeecafd7f0254f5bad432f2323b202700">serialNumber</a>;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    handle = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#gae94fdee0967a330a197b783c781e36fb">MV_CC_CreateHandle</a>(info);</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (handle == <span class="keyword">null</span>) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;CreateHandle fail! nRet&quot;</span>);</div><div class="line">                    enumBtSetEnabled(<span class="keyword">true</span>);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordtype">int</span> nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga4e982ac1afd05dec95710ac2adcb6c6a">MV_CC_OpenDevice</a>(handle);</div><div class="line">                <span class="keywordflow">if</span> (nRet != 0) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;OpenDevice fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    enumBtSetEnabled(<span class="keyword">true</span>);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (deviceList.get(selectNum).<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines.MV_GIGE_DEVICE) {</div><div class="line">                    <span class="keywordtype">int</span> nPacketSize = MvCameraControl. <a class="code" href="group___gig_e_xE6_x8E_xA5_xE5_x8F_xA3_xE5_x87_xBD_xE6_x95_xB0.html#ga86ef17ec299b0ff442a063132ced4e6b">MV_CC_GetOptimalPacketSize</a>(handle);</div><div class="line">                    <span class="keywordflow">if</span> (nPacketSize &gt; 0) {</div><div class="line">                        nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga8932770d409766b20cc6819b6d48733f">MV_CC_SetIntValue</a>(handle,<span class="stringliteral">&quot;GevSCPSPacketSize&quot;</span>, nPacketSize);</div><div class="line">                        <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                            showLog(<span class="stringliteral">&quot;Warning: Set Packet Size fail nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">                            enumBtSetEnabled(<span class="keyword">true</span>);</div><div class="line">                            <span class="keywordflow">return</span>;</div><div class="line">                        }</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        showLog(<span class="stringliteral">&quot;Warning: Get Packet Size fail nRet&quot;</span> + Integer.toHexString(nPacketSize));</div><div class="line">                    }</div><div class="line">                }</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga69d2f77efcabbdf57be21ab9465ee70f">MV_CC_SetEnumValue</a>(handle,<span class="stringliteral">&quot;TriggerMode&quot;</span>, 0);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_SetTriggerMode fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    enumBtSetEnabled(<span class="keyword">true</span>);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="comment">// 注册抓图回调</span></div><div class="line">                <span class="comment">// register image callback</span></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga52ef975ad47c0ad8ea71480c64e71d80">MV_CC_RegisterImageCallBack</a>(handle,cameraImageCallBack);</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_RegisterImageCallBackEx fail! nRet&quot;</span> + nRet);</div><div class="line">                    enumBtSetEnabled(<span class="keyword">true</span>);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE9_x80_x9A_xE7_x94_xA8_xE6_x8E_xA5_xE5_x8F_xA3.html#gae8d098b664632d4ccfb2b220ba351b90">MV_CC_RegisterExceptionCallBack</a>(handle,cameraExceptionCallBack);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;RegisterExceptionCallBackBt fail! nRet&quot;</span> + nRet);</div><div class="line">                    enumBtSetEnabled(<span class="keyword">true</span>);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="comment">// 开始取流</span></div><div class="line">                <span class="comment">// start grab image</span></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga5ee1c63aac34f3d8ea0ea5c2f5f734f2">MV_CC_StartGrabbing</a>(handle);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_StartGrabbing fail! nRet&quot;</span> + nRet);</div><div class="line">                    enumBtSetEnabled(<span class="keyword">true</span>);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">                    @Override</div><div class="line">                    <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                        enumBtSetEnabled(<span class="keyword">true</span>);</div><div class="line">                        closeDeviceBt.setEnabled(<span class="keyword">true</span>);</div><div class="line">                        openDeviceBt.setEnabled(<span class="keyword">false</span>);</div><div class="line">                    }</div><div class="line">                });</div><div class="line"></div><div class="line">                isConnect = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                toast(<span class="stringliteral">&quot;Please enumerate the devices first&quot;</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">class </span>CloseDeviceThread <span class="keyword">extends</span> Thread {</div><div class="line">        @Override</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">            super.run();</div><div class="line">            <span class="comment">// 停止取流</span></div><div class="line">            <span class="comment">// end grab image</span></div><div class="line">            <span class="keywordtype">int</span> nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga951784eace474e8a5049c911966c381f">MV_CC_StopGrabbing</a>(handle);</div><div class="line">            <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                showLog(<span class="stringliteral">&quot;MV_CC_StopGrabbing fail! nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            <span class="comment">// 关闭设备</span></div><div class="line">            <span class="comment">// close device</span></div><div class="line">            nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga9200ad9b866b2fc9b8cae94fbba56fde">MV_CC_CloseDevice</a>(handle);</div><div class="line">            <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                showLog(<span class="stringliteral">&quot;MV_CC_CloseDevice fail! nRet &quot;</span> + nRet);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            <span class="comment">// 销毁句柄</span></div><div class="line">            <span class="comment">// destroy handle</span></div><div class="line">            nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga8385105a0abb3a23dc2728ce980656ba">MV_CC_DestroyHandle</a>(handle);</div><div class="line">            <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                showLog(<span class="stringliteral">&quot;MV_CC_DestroyHandle fail! nRet&quot;</span> + nRet);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">                @Override</div><div class="line">                <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                    closeDeviceBt.setEnabled(<span class="keyword">false</span>);</div><div class="line">                    openDeviceBt.setEnabled(<span class="keyword">true</span>);</div><div class="line">                }</div><div class="line">            });</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">class </span>ReconnectThread <span class="keyword">extends</span> Thread {</div><div class="line"></div><div class="line">        <span class="keyword">private</span> ArrayList&lt;MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a>&gt; reDeviceList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="keyword">private</span> <span class="keywordtype">int</span> reSelectNum = 0;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">            super.run();</div><div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; 10; x++) {</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    Thread.sleep(30000);</div><div class="line">                } <span class="keywordflow">catch</span> (InterruptedException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (isConnect) {</div><div class="line">                    <span class="keywordflow">try</span> {</div><div class="line">                        sleep(1000);</div><div class="line">                    } <span class="keywordflow">catch</span> (InterruptedException e) {</div><div class="line">                        e.printStackTrace();</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">break</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (!isConnect) {</div><div class="line">                    MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga951784eace474e8a5049c911966c381f">MV_CC_StopGrabbing</a>(handle);</div><div class="line">                    MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga9200ad9b866b2fc9b8cae94fbba56fde">MV_CC_CloseDevice</a>(handle);</div><div class="line">                    MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga8385105a0abb3a23dc2728ce980656ba">MV_CC_DestroyHandle</a>(handle);</div><div class="line">                }</div><div class="line">                reDeviceList.clear();</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    reDeviceList =  MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga2e162b1972c75982ff1c52e1c5d34a4e">MV_CC_EnumDevices</a>(MvCameraControlDefines.MV_USB_DEVICE | MvCameraControlDefines.MV_GIGE_DEVICE);</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                }</div><div class="line">                showLog(<span class="stringliteral">&quot;Reconnect enumDevices&quot;</span>);</div><div class="line">                <span class="keywordtype">boolean</span> findDevice = <span class="keyword">false</span>;</div><div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; reDeviceList.size(); i++) {</div><div class="line">                    <span class="keywordflow">if</span> (reDeviceList.get(i).<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MV_GIGE_DEVICE) {</div><div class="line">                        <span class="keywordflow">if</span> (reDeviceList.get(i).<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a727f4f765547596fdca29f86a2406dc9">serialNumber</a>.equals(strSerialNumber)) {</div><div class="line">                            reSelectNum = i;</div><div class="line">                            findDevice = <span class="keyword">true</span>;</div><div class="line">                            <span class="keywordflow">break</span>;</div><div class="line">                        }</div><div class="line">                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (reDeviceList.get(i).<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MV_USB_DEVICE) {</div><div class="line">                        <span class="keywordflow">if</span> (reDeviceList.get(i).<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aeecafd7f0254f5bad432f2323b202700">serialNumber</a>.equals(strSerialNumber)) {</div><div class="line">                            reSelectNum = i;</div><div class="line">                            findDevice = <span class="keyword">true</span>;</div><div class="line">                            <span class="keywordflow">break</span>;</div><div class="line">                        }</div><div class="line">                    }</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (findDevice) {</div><div class="line">                    <span class="keywordflow">try</span> {</div><div class="line">                        handle = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#gae94fdee0967a330a197b783c781e36fb">MV_CC_CreateHandle</a>(reDeviceList.get(reSelectNum));</div><div class="line">                    } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                        e.printStackTrace();</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">if</span> (handle== <span class="keyword">null</span>) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;CreateHandle fail! nRet&quot;</span> );</div><div class="line">                        <span class="keywordflow">continue</span>;</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        showLog(<span class="stringliteral">&quot;Reconnect createHandle&quot;</span>);</div><div class="line">                    }</div><div class="line">                    <span class="keywordtype">int</span> nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga4e982ac1afd05dec95710ac2adcb6c6a">MV_CC_OpenDevice</a>(handle);</div><div class="line">                    <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;OpenDevice fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                        <span class="keywordflow">continue</span>;</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        showLog(<span class="stringliteral">&quot;Reconnect openDevice&quot;</span>);</div><div class="line">                    }</div><div class="line">                    nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga52ef975ad47c0ad8ea71480c64e71d80">MV_CC_RegisterImageCallBack</a>(handle,cameraImageCallBack);</div><div class="line">                    <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;RegisterImageCallBackEx fail! nRet&quot;</span> + nRet);</div><div class="line">                        <span class="keywordflow">continue</span>;</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        showLog(<span class="stringliteral">&quot;Reconnect registerImageCallBack&quot;</span>);</div><div class="line">                    }</div><div class="line">                    nRet = MvCameraControl. <a class="code" href="group___xE9_x80_x9A_xE7_x94_xA8_xE6_x8E_xA5_xE5_x8F_xA3.html#gae8d098b664632d4ccfb2b220ba351b90">MV_CC_RegisterExceptionCallBack</a>(handle,cameraExceptionCallBack);</div><div class="line">                    <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;RegisterExceptionCallBackBt fail! nRet&quot;</span> + nRet);</div><div class="line">                        <span class="keywordflow">continue</span>;</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        showLog(<span class="stringliteral">&quot;Reconnect RegisterExceptionCallBackBt&quot;</span>);</div><div class="line">                    }</div><div class="line">                    nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga5ee1c63aac34f3d8ea0ea5c2f5f734f2">MV_CC_StartGrabbing</a>(handle);</div><div class="line">                    <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;StartGrabbing fail! nRet&quot;</span> + nRet);</div><div class="line">                        <span class="keywordflow">continue</span>;</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        showLog(<span class="stringliteral">&quot;Reconnect StartGrabbing&quot;</span>);</div><div class="line">                        isConnect = <span class="keyword">true</span>;</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> enumBtSetEnabled(<span class="keyword">final</span> <span class="keywordtype">boolean</span> flag)</div><div class="line">    {</div><div class="line">        runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                enumDevicesBt.setEnabled(flag);</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="设置相机静态ip"></a>
SetIpActivity.java</h1>
<p>设置相机静态ip</p>
<p>该示例程序说明了如何设置网口相机静态ip。通过输入相机ip，子网掩码（NetMask），默认网关（DefaultWay）来设置相机ip地址。输入的格式为xx.xx.xx.xx。 </p><div class="fragment"><div class="line"><span class="keyword">package </span>com.example.setIp;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.text.method.ScrollingMovementMethod;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.Button;</div><div class="line"><span class="keyword">import</span> android.widget.EditText;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.CameraManager;</div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.IMainView;</div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.IpUtil;</div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.LogView;</div><div class="line"><span class="keyword">import</span> com.jaredrummler.materialspinner.MaterialSpinner;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.CameraControlException;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControl;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControlDefines;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>SetIpActivity <span class="keyword">extends</span> AppCompatActivity implements IMainView {</div><div class="line">    <span class="keyword">private</span> ArrayList&lt;MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a>&gt; deviceList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">private</span> MaterialSpinner spinner;</div><div class="line">    EditText logTv;</div><div class="line">    <span class="keywordtype">int</span> selectNum = 0;</div><div class="line">    Button openDeviceBt;</div><div class="line">    <span class="keyword">private</span> EditText ipEdit;</div><div class="line">    <span class="keyword">private</span> EditText subNetMaskEdit;</div><div class="line">    <span class="keyword">private</span> EditText defaultGateWayEdit;</div><div class="line">    MvCameraControlDefines.Handle handle = <span class="keyword">null</span>;</div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onCreate(Bundle savedInstanceState) {</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_set_ip);</div><div class="line">        initView();</div><div class="line">        initListener();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initView() {</div><div class="line">        ipEdit = findViewById(R.id.ipEdit);</div><div class="line">        subNetMaskEdit = findViewById(R.id.subNetMaskEdit);</div><div class="line">        defaultGateWayEdit = findViewById(R.id.defaultGateWayEdit);</div><div class="line"></div><div class="line">        spinner = findViewById(R.id.spinner);</div><div class="line">        logTv = findViewById(R.id.logTv);</div><div class="line">        logTv.setMovementMethod(ScrollingMovementMethod.getInstance());</div><div class="line">        openDeviceBt = findViewById(R.id.openDeviceBt);</div><div class="line">        spinner.setOnItemSelectedListener(<span class="keyword">new</span> MaterialSpinner.OnItemSelectedListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onItemSelected(MaterialSpinner view, <span class="keywordtype">int</span> position, <span class="keywordtype">long</span> <span class="keywordtype">id</span>, Object item) {</div><div class="line">                selectNum = position;</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initListener() {</div><div class="line">        findViewById(R.id.enumDevicesBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                selectNum = 0;</div><div class="line">                deviceList.clear();</div><div class="line">                spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    deviceList = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga2e162b1972c75982ff1c52e1c5d34a4e">MV_CC_EnumDevices</a>(MvCameraControlDefines.MV_USB_DEVICE | MvCameraControlDefines.MV_GIGE_DEVICE);</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (deviceList != <span class="keyword">null</span>) {</div><div class="line">                    <span class="keywordtype">int</span> size = deviceList.size();</div><div class="line">                    <span class="keywordflow">if</span> (size &gt; 0) {</div><div class="line">                        List&lt;String&gt; deviceName = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++) {</div><div class="line">                            MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a> entity = deviceList.get(i);</div><div class="line">                            <span class="keywordflow">if</span> (entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines.MV_GIGE_DEVICE) {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a9e8dbdf67802699038b0421c0d311499">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a727f4f765547596fdca29f86a2406dc9">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a0a3a766f998932a02e10e0223b05801c">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#ac0d8c9621aa38cb936f906d981c6a31b">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            } <span class="keywordflow">else</span> {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#ac568233b448c639976fe3280fcc2d0d5">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aeecafd7f0254f5bad432f2323b202700">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#a6b9a01f50a786e68ab65f3ba33079d26">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aac5ebaab488a72e9a7dcb2a5818e33bc">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            }</div><div class="line"></div><div class="line">                        }</div><div class="line">                        spinner.setItems(deviceName);</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                    }</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Not enumerated to device&quot;</span>);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        findViewById(R.id.openDeviceBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                openDevice();</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> openDevice() {</div><div class="line">        <span class="keywordflow">if</span> (deviceList != <span class="keyword">null</span> &amp;&amp; deviceList.size() &gt; 0) {</div><div class="line">            <span class="keywordflow">try</span> {</div><div class="line">                handle =MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#gae94fdee0967a330a197b783c781e36fb">MV_CC_CreateHandle</a>(deviceList.get(selectNum));</div><div class="line">            } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                e.printStackTrace();</div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span> (handle == <span class="keyword">null</span>) {</div><div class="line">                showLog(<span class="stringliteral">&quot;CreateHandle fail! nRet&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line"></div><div class="line"></div><div class="line">            String ip = ipEdit.getText().toString();</div><div class="line">            <span class="keywordflow">if</span> (ip.length() == 0){</div><div class="line">                toast(<span class="stringliteral">&quot;ip cannot be empty&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span> (!IpUtil.isboolIp(ip)){</div><div class="line">                toast(<span class="stringliteral">&quot;Please enter the correct ip&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line"></div><div class="line"></div><div class="line">            String subNetMask = subNetMaskEdit.getText().toString();</div><div class="line">            <span class="keywordflow">if</span> (subNetMask.length() == 0){</div><div class="line">                toast(<span class="stringliteral">&quot;subNetMask cannot be empty&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span> (!IpUtil.isboolIp(subNetMask)){</div><div class="line">                toast(<span class="stringliteral">&quot;Please enter the correct subNetMask&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line"></div><div class="line">            String defaultGateWay = defaultGateWayEdit.getText().toString();</div><div class="line">            <span class="keywordflow">if</span> (defaultGateWay.length() == 0){</div><div class="line">                toast(<span class="stringliteral">&quot;defaultGateWay cannot be empty&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">            <span class="keywordflow">if</span> (!IpUtil.isboolIp(defaultGateWay)){</div><div class="line">                toast(<span class="stringliteral">&quot;Please enter the correct defaultGateWay&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line"></div><div class="line"></div><div class="line">            <span class="keywordtype">int</span> nRet = MvCameraControl. <a class="code" href="group___gig_e_xE6_x8E_xA5_xE5_x8F_xA3_xE5_x87_xBD_xE6_x95_xB0.html#gabf8fb4b208fe48aa8605c6cbf6fb0a8c">MV_GIGE_ForceIp</a>(handle,ip, subNetMask, defaultGateWay);</div><div class="line">            <span class="keywordflow">if</span> (nRet != MvCameraControlDefines.MV_OK) {</div><div class="line">                showLog(<span class="stringliteral">&quot;MV_GIGE_ForceIpEx fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">            }<span class="keywordflow">else</span>{</div><div class="line">                showLog(<span class="stringliteral">&quot;Modify camera ip success&quot;</span>);</div><div class="line">            }</div><div class="line">            MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga8385105a0abb3a23dc2728ce980656ba">MV_CC_DestroyHandle</a>(handle);</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            toast(<span class="stringliteral">&quot;Please enumerate the devices first&quot;</span>);</div><div class="line">            <span class="keywordflow">return</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> showLog(<span class="keyword">final</span> String str) {</div><div class="line">        LogView.showLog(<span class="keyword">this</span>,logTv,str);</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateButton(<span class="keywordtype">int</span> state) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateImage(<span class="keywordtype">byte</span>[] data) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> toast(String <span class="keywordtype">string</span>) {</div><div class="line">        Toast.makeText(SetIpActivity.this, <span class="keywordtype">string</span>, Toast.LENGTH_SHORT).show();</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onDestroy() {</div><div class="line">        super.onDestroy();</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="设置相机参数"></a>
SetParamActivity.java</h1>
<p>设置相机参数</p>
<p>该示例程序说明了如何使用通用接口设置相机参数，包括Int、Float、Enum、Bool等类型节点的设置。 </p><div class="fragment"><div class="line"><span class="keyword">package </span>com.example.setparam;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.text.method.ScrollingMovementMethod;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.Button;</div><div class="line"><span class="keyword">import</span> android.widget.EditText;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.IMainView;</div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.LogView;</div><div class="line"><span class="keyword">import</span> com.jaredrummler.materialspinner.MaterialSpinner;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.CameraControlException;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControl;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControlDefines;</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> MvCameraControlWrapper.MvCameraControlDefines.MV_OK;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>SetParamActivity <span class="keyword">extends</span> AppCompatActivity implements IMainView {</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">private</span> ArrayList&lt;MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a>&gt; deviceList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">private</span> MaterialSpinner spinner;</div><div class="line">    EditText logTv;</div><div class="line">    <span class="keywordtype">int</span> selectNum = 0;</div><div class="line">    Button openDeviceBt;</div><div class="line">    MvCameraControlDefines.MV_FRAME_OUT_INFO info = <span class="keyword">new</span> MvCameraControlDefines.MV_FRAME_OUT_INFO();</div><div class="line">    MvCameraControlDefines.Handle handle = <span class="keyword">null</span>;</div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onCreate(Bundle savedInstanceState) {</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_set_param_main);</div><div class="line">        initView();</div><div class="line">        initListener();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initView() {</div><div class="line">        spinner = findViewById(R.id.spinner);</div><div class="line">        logTv = findViewById(R.id.logTv);</div><div class="line">        logTv.setMovementMethod(ScrollingMovementMethod.getInstance());</div><div class="line">        openDeviceBt = findViewById(R.id.openDeviceBt);</div><div class="line">        spinner.setOnItemSelectedListener(<span class="keyword">new</span> MaterialSpinner.OnItemSelectedListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onItemSelected(MaterialSpinner view, <span class="keywordtype">int</span> position, <span class="keywordtype">long</span> <span class="keywordtype">id</span>, Object item) {</div><div class="line">                selectNum = position;</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initListener() {</div><div class="line">        findViewById(R.id.enumDevicesBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                selectNum = 0;</div><div class="line">                deviceList.clear();</div><div class="line">                spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    deviceList = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga2e162b1972c75982ff1c52e1c5d34a4e">MV_CC_EnumDevices</a>(MvCameraControlDefines.MV_USB_DEVICE | MvCameraControlDefines.MV_GIGE_DEVICE);</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (deviceList != <span class="keyword">null</span>) {</div><div class="line">                    <span class="keywordtype">int</span> size = deviceList.size();</div><div class="line">                    <span class="keywordflow">if</span> (size &gt; 0) {</div><div class="line">                        List&lt;String&gt; deviceName = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++) {</div><div class="line">                            MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a> entity = deviceList.get(i);</div><div class="line">                            <span class="keywordflow">if</span> (entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines.MV_GIGE_DEVICE) {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a9e8dbdf67802699038b0421c0d311499">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a727f4f765547596fdca29f86a2406dc9">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a0a3a766f998932a02e10e0223b05801c">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#ac0d8c9621aa38cb936f906d981c6a31b">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            } <span class="keywordflow">else</span> {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#ac568233b448c639976fe3280fcc2d0d5">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aeecafd7f0254f5bad432f2323b202700">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#a6b9a01f50a786e68ab65f3ba33079d26">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aac5ebaab488a72e9a7dcb2a5818e33bc">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            }</div><div class="line"></div><div class="line">                        }</div><div class="line">                        spinner.setItems(deviceName);</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                    }</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Not enumerated to device&quot;</span>);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        findViewById(R.id.openDeviceBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                openDevice();</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> openDevice() {</div><div class="line">        SetParamThread setParamThread = <span class="keyword">new</span> SetParamThread();</div><div class="line">        setParamThread.start();</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> showLog(<span class="keyword">final</span> String str) {</div><div class="line">        LogView.showLog(<span class="keyword">this</span>,logTv,str);</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateButton(<span class="keywordtype">int</span> state) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateImage(<span class="keywordtype">byte</span>[] data) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> toast(String <span class="keywordtype">string</span>) {</div><div class="line">        Toast.makeText(SetParamActivity.this, <span class="keywordtype">string</span>, Toast.LENGTH_SHORT).show();</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onDestroy() {</div><div class="line">        super.onDestroy();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">class </span>SetParamThread <span class="keyword">extends</span> Thread {</div><div class="line">        @Override</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">            super.run();</div><div class="line">            <span class="keywordflow">if</span> (deviceList != <span class="keyword">null</span> &amp;&amp; deviceList.size() &gt; 0) {</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    handle =  MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#gae94fdee0967a330a197b783c781e36fb">MV_CC_CreateHandle</a>(deviceList.get(selectNum));</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (handle == <span class="keyword">null</span>) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;CreateHandle fail! nRet&quot;</span> );</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordtype">int</span> nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga4e982ac1afd05dec95710ac2adcb6c6a">MV_CC_OpenDevice</a>(handle);</div><div class="line">                <span class="keywordflow">if</span> (nRet != 0) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;OpenDevice fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line"></div><div class="line">                <span class="comment">// 获取int型变量</span></div><div class="line">                <span class="comment">// get IInteger variable</span></div><div class="line">                MvCameraControlDefines.MVCC_INTVALUE stHeight = <span class="keyword">new</span> MvCameraControlDefines.MVCC_INTVALUE();</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga44cb71a1f783fef852b51c1405560ce1">MV_CC_GetIntValue</a>(handle,<span class="stringliteral">&quot;Height&quot;</span>, stHeight);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK == nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;height current value:&quot;</span> + stHeight.curValue);</div><div class="line">                    showLog(<span class="stringliteral">&quot;height max value&quot;</span> + stHeight.max);</div><div class="line">                    showLog(<span class="stringliteral">&quot;height min value&quot;</span> + stHeight.min);</div><div class="line">                    showLog(<span class="stringliteral">&quot;height increment value&quot;</span> + stHeight.inc);</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    showLog(<span class="stringliteral">&quot;get height failed! nRet&quot;</span> + nRet);</div><div class="line">                }</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">                <span class="keywordtype">int</span> nHeightValue = 1024;</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga8932770d409766b20cc6819b6d48733f">MV_CC_SetIntValue</a>(handle,<span class="stringliteral">&quot;Height&quot;</span>, nHeightValue);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK == nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;set height OK!&quot;</span>);</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    showLog(<span class="stringliteral">&quot;set height failed! nRet &quot;</span> + nRet);</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="comment">// 获取float型变量</span></div><div class="line">                <span class="comment">// get IFloat variable</span></div><div class="line">                MvCameraControlDefines. <a class="code" href="class_m_v_c_c___f_l_o_a_t_v_a_l_u_e.html">MVCC_FLOATVALUE</a> stExposureTime = <span class="keyword">new</span> MvCameraControlDefines. <a class="code" href="class_m_v_c_c___f_l_o_a_t_v_a_l_u_e.html">MVCC_FLOATVALUE</a>();</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#gaf694d5c6d4e22ecff36f9aca9a8ef8ac">MV_CC_GetFloatValue</a>(handle,<span class="stringliteral">&quot;ExposureTime&quot;</span>, stExposureTime);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK == nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;exposure time current value&quot;</span> + stExposureTime.<a class="code" href="class_m_v_c_c___f_l_o_a_t_v_a_l_u_e.html#a6b118918512450c48c60a3de646e8692">curValue</a>);</div><div class="line">                    showLog(<span class="stringliteral">&quot;exposure time max value&quot;</span> + stExposureTime.<a class="code" href="class_m_v_c_c___f_l_o_a_t_v_a_l_u_e.html#a845d9df3cb6e7a97d17ccbd09da1509a">max</a>);</div><div class="line">                    showLog(<span class="stringliteral">&quot;exposure time min value&quot;</span> + stExposureTime.<a class="code" href="class_m_v_c_c___f_l_o_a_t_v_a_l_u_e.html#a2c66abaf09116ce2229872c9b3f0ef48">min</a>);</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    showLog(<span class="stringliteral">&quot;get exposure time failed! nRet &quot;</span> + nRet);</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordtype">float</span> gain = 2f;</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#gaeabd5f3ae401fcf3e25fd7eae5bf003b">MV_CC_SetFloatValue</a>(handle,<span class="stringliteral">&quot;Gain&quot;</span>, gain);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK == nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;set gain OK!&quot;</span>);</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    showLog(<span class="stringliteral">&quot;set gain failed! nRet&quot;</span> + nRet);</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="comment">// 获取enum型变量</span></div><div class="line">                <span class="comment">// get IEnumeration variable</span></div><div class="line">                MvCameraControlDefines. <a class="code" href="class_m_v_c_c___e_n_u_m_v_a_l_u_e.html">MVCC_ENUMVALUE</a> stTriggerMode = <span class="keyword">new</span> MvCameraControlDefines. <a class="code" href="class_m_v_c_c___e_n_u_m_v_a_l_u_e.html">MVCC_ENUMVALUE</a>();</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#gad9dbf0c868b34740790238ce4a3cf3bb">MV_CC_GetEnumValue</a>(handle,<span class="stringliteral">&quot;TriggerMode&quot;</span>, stTriggerMode);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK == nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;TriggerMode current value&quot;</span> + stTriggerMode.<a class="code" href="class_m_v_c_c___e_n_u_m_v_a_l_u_e.html#a26511b6723a32d0413eed973dc427278">curValue</a>);</div><div class="line"></div><div class="line"></div><div class="line">                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; stTriggerMode.<a class="code" href="class_m_v_c_c___e_n_u_m_v_a_l_u_e.html#a43f07729ca470b0af584e4a2b281c17c">supportValue</a>.size(); i++) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;supported TriggerMode &quot;</span> + stTriggerMode.<a class="code" href="class_m_v_c_c___e_n_u_m_v_a_l_u_e.html#a43f07729ca470b0af584e4a2b281c17c">supportValue</a>.get(i).intValue() + <span class="stringliteral">&quot;&quot;</span>);</div><div class="line">                    }</div><div class="line"></div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    showLog(<span class="stringliteral">&quot;get TriggerMode failed! nRet&quot;</span> + nRet);</div><div class="line">                }</div><div class="line"></div><div class="line"></div><div class="line">                <span class="keywordtype">int</span> nTriggerMode = 0;</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga69d2f77efcabbdf57be21ab9465ee70f">MV_CC_SetEnumValue</a>(handle,<span class="stringliteral">&quot;TriggerMode&quot;</span>, nTriggerMode);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK == nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;set TriggerMode OK!&quot;</span>);</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    showLog(<span class="stringliteral">&quot;set TriggerMode failed! nRet &quot;</span> + nRet);</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="comment">// 获取bool型变量</span></div><div class="line">                <span class="comment">// get IBoolean variable</span></div><div class="line">                Boolean bGetBoolValue = <span class="keyword">false</span>;</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#gaa4e01cf2051baa14eb9e5bc5f75de74b">MV_CC_GetBoolValue</a>(handle,<span class="stringliteral">&quot;ReverseX&quot;</span>, bGetBoolValue);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK == nRet) {</div><div class="line"></div><div class="line">                    showLog(<span class="stringliteral">&quot;ReverseX current is&quot;</span> + bGetBoolValue);</div><div class="line"></div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordtype">boolean</span> nSetBoolValue = <span class="keyword">false</span>;</div><div class="line"></div><div class="line"></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#gac44d08a8835616c96207ab3ed9e8aa6a">MV_CC_SetBoolValue</a>(handle,<span class="stringliteral">&quot;ReverseX&quot;</span>, nSetBoolValue);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK == nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Set ReverseX OK!&quot;</span>);</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Set ReverseX Failed! nRet&quot;</span> + nRet);</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="comment">// 获取string型变量</span></div><div class="line">                <span class="comment">// get IString variable</span></div><div class="line">                MvCameraControlDefines. MVCC_STRINGVALUE stStringValue = <span class="keyword">new</span> MvCameraControlDefines. MVCC_STRINGVALUE();</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga68486abf4461e320035ffde1f4aafc8a">MV_CC_GetStringValue</a>(handle,<span class="stringliteral">&quot;DeviceUserID&quot;</span>, stStringValue);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK == nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Get DeviceUserID&quot;</span> + stStringValue.curValue);</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Get DeviceUserID Failed! nRet&quot;</span> + nRet);</div><div class="line">                }</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#gaa5b065405bc41a13732ec98ff1058ef0">MV_CC_SetStringValue</a>(handle,<span class="stringliteral">&quot;DeviceUserID&quot;</span>, <span class="stringliteral">&quot;hktestDev&quot;</span>);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK == nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Set DeviceUserID OK!&quot;</span>);</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Set DeviceUserID Failed! nRet &quot;</span> + nRet);</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="comment">// 关闭设备</span></div><div class="line">                <span class="comment">// close device</span></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga9200ad9b866b2fc9b8cae94fbba56fde">MV_CC_CloseDevice</a>(handle);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_CloseDevice fail! nRet&quot;</span> +  nRet);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="comment">// 销毁句柄</span></div><div class="line">                <span class="comment">// destroy handle</span></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga8385105a0abb3a23dc2728ce980656ba">MV_CC_DestroyHandle</a>(handle);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_DestroyHandle fail! nRet&quot;</span> + nRet);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                toast(<span class="stringliteral">&quot;Please enumerate the devices first&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="触发模式获取相机图像"></a>
TriggerImageActivity.java</h1>
<p>触发模式获取相机图像</p>
<p>该示例程序说明了触发模式下通过软触发主动取图的方式获取图像。创建句柄，打开相机，设置触发模式，设置触发源（软触发），开始取流，创建取流线程（发送软触发command命令， <a class="el" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#gae1a51a885f885902d8783e1237556e48" title="获取一帧图像数据">MV_CC_GetOneFrameTimeout()</a> 取图），停止取流，关闭相机，销毁句柄。 </p><div class="fragment"><div class="line"><span class="keyword">package </span>com.example.triggerimage;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.text.method.ScrollingMovementMethod;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.Button;</div><div class="line"><span class="keyword">import</span> android.widget.EditText;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.CameraManager;</div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.IMainView;</div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.LogView;</div><div class="line"><span class="keyword">import</span> com.jaredrummler.materialspinner.MaterialSpinner;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.CameraControlException;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControl;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControlDefines;</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> MvCameraControlWrapper.MvCameraControlDefines.MV_OK;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>TriggerImageActivity <span class="keyword">extends</span> AppCompatActivity implements IMainView {</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ArrayList&lt;MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a>&gt; deviceList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">private</span> MaterialSpinner spinner;</div><div class="line">    EditText logTv;</div><div class="line">    <span class="keywordtype">int</span> selectNum = 0;</div><div class="line">    Button closeDeviceBt;</div><div class="line">    Button openDeviceBt;</div><div class="line">    <span class="keywordtype">byte</span>[] datas = <span class="keyword">null</span>;</div><div class="line">    MvCameraControlDefines.MV_FRAME_OUT_INFO info = <span class="keyword">new</span> MvCameraControlDefines.MV_FRAME_OUT_INFO();</div><div class="line">    GetOneFrameThread getOneFrameThread;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keywordtype">int</span> MV_TRIGGER_SOURCE_SOFTWARE          = 7;</div><div class="line">    MvCameraControlDefines.Handle handle = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onCreate(Bundle savedInstanceState) {</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_trigger_image);</div><div class="line">        initView();</div><div class="line">        initListener();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initView() {</div><div class="line">        spinner = findViewById(R.id.spinner);</div><div class="line">        logTv = findViewById(R.id.logTv);</div><div class="line">        logTv.setMovementMethod(ScrollingMovementMethod.getInstance());</div><div class="line">        openDeviceBt = findViewById(R.id.openDeviceBt);</div><div class="line">        closeDeviceBt = findViewById(R.id.closeDeviceBt);</div><div class="line">        spinner.setOnItemSelectedListener(<span class="keyword">new</span> MaterialSpinner.OnItemSelectedListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onItemSelected(MaterialSpinner view, <span class="keywordtype">int</span> position, <span class="keywordtype">long</span> <span class="keywordtype">id</span>, Object item) {</div><div class="line">                selectNum = position;</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initListener() {</div><div class="line">        findViewById(R.id.enumDevicesBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                selectNum = 0;</div><div class="line">                deviceList.clear();</div><div class="line">                spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line"></div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    deviceList = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga2e162b1972c75982ff1c52e1c5d34a4e">MV_CC_EnumDevices</a>(MvCameraControlDefines.MV_USB_DEVICE | MvCameraControlDefines.MV_GIGE_DEVICE);</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (deviceList != <span class="keyword">null</span>) {</div><div class="line">                    <span class="keywordtype">int</span> size = deviceList.size();</div><div class="line">                    <span class="keywordflow">if</span> (size &gt; 0) {</div><div class="line">                        List&lt;String&gt; deviceName = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++) {</div><div class="line">                            MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a> entity = deviceList.get(i);</div><div class="line">                            <span class="keywordflow">if</span> (entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines.MV_GIGE_DEVICE) {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a9e8dbdf67802699038b0421c0d311499">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a727f4f765547596fdca29f86a2406dc9">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a0a3a766f998932a02e10e0223b05801c">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#ac0d8c9621aa38cb936f906d981c6a31b">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines.MV_USB_DEVICE){</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#ac568233b448c639976fe3280fcc2d0d5">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aeecafd7f0254f5bad432f2323b202700">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#a6b9a01f50a786e68ab65f3ba33079d26">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aac5ebaab488a72e9a7dcb2a5818e33bc">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            }</div><div class="line"></div><div class="line">                        }</div><div class="line">                        spinner.setItems(deviceName);</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                    }</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Not enumerated to device&quot;</span>);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        findViewById(R.id.openDeviceBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                openDevice();</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        findViewById(R.id.closeDeviceBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                closeDevice();</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> openDevice() {</div><div class="line">        <span class="keywordflow">if</span> (getOneFrameThread == <span class="keyword">null</span>) {</div><div class="line">            getOneFrameThread = <span class="keyword">new</span> GetOneFrameThread(<span class="keyword">new</span> IExitGetOneFrame() {</div><div class="line">                @Override</div><div class="line">                <span class="keyword">public</span> <span class="keywordtype">void</span> exit() {</div><div class="line">                    <span class="comment">// 停止取流</span></div><div class="line">                    <span class="comment">// end grab image</span></div><div class="line">                    <span class="keywordtype">int</span> nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga951784eace474e8a5049c911966c381f">MV_CC_StopGrabbing</a>(handle);</div><div class="line">                    <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;MV_CC_StopGrabbing fail! nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    }</div><div class="line">                    <span class="comment">// 关闭设备</span></div><div class="line">                    <span class="comment">// close device</span></div><div class="line">                    nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga9200ad9b866b2fc9b8cae94fbba56fde">MV_CC_CloseDevice</a>(handle);</div><div class="line">                    <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;MV_CC_CloseDevice fail! nRet &quot;</span> + nRet);</div><div class="line">                    }</div><div class="line">                    <span class="comment">// 销毁句柄</span></div><div class="line">                    <span class="comment">// destroy handle</span></div><div class="line">                    nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga8385105a0abb3a23dc2728ce980656ba">MV_CC_DestroyHandle</a>(handle);</div><div class="line">                    <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;MV_CC_DestroyHandle fail! nRet&quot;</span> + nRet);</div><div class="line">                    }</div><div class="line">                    runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">                        @Override</div><div class="line">                        <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                            openDeviceBt.setEnabled(<span class="keyword">true</span>);</div><div class="line">                            closeDeviceBt.setEnabled(<span class="keyword">false</span>);</div><div class="line">                        }</div><div class="line">                    });</div><div class="line">                }</div><div class="line">            });</div><div class="line">            getOneFrameThread.start();</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            getOneFrameThread.start();</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> showLog( <span class="keyword">final</span> String str) {</div><div class="line">        LogView.showLog(<span class="keyword">this</span>,logTv,str);</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateButton(<span class="keywordtype">int</span> state) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateImage(<span class="keywordtype">byte</span>[] data) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> toast(<span class="keyword">final</span> String <span class="keywordtype">string</span>) {</div><div class="line">        runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                Toast.makeText(TriggerImageActivity.this, <span class="keywordtype">string</span>, Toast.LENGTH_SHORT).show();</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> closeDevice() {</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (getOneFrameThread != <span class="keyword">null</span>) {</div><div class="line">            <span class="keywordflow">if</span> (!getOneFrameThread.isInterrupted()) {</div><div class="line">                getOneFrameThread.interrupt();</div><div class="line">            }</div><div class="line">            showLog(<span class="stringliteral">&quot;Streaming thread exits&quot;</span>);</div><div class="line">        }</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onDestroy() {</div><div class="line">        super.onDestroy();</div><div class="line">        <span class="keywordflow">if</span> (closeDeviceBt.isEnabled()) {</div><div class="line">            closeDevice();</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">class </span>GetOneFrameThread <span class="keyword">extends</span> Thread {</div><div class="line">        IExitGetOneFrame iExitGetOneFrame;</div><div class="line"></div><div class="line">        <span class="keyword">public</span> GetOneFrameThread(IExitGetOneFrame iExitGetOneFrame) {</div><div class="line">            this.iExitGetOneFrame = iExitGetOneFrame;</div><div class="line">        }</div><div class="line"></div><div class="line">        @Override</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">            super.run();</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (deviceList != <span class="keyword">null</span> &amp;&amp; deviceList.size() &gt; 0) {</div><div class="line">                <span class="keywordtype">int</span> nRet = 0;</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    handle = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#gae94fdee0967a330a197b783c781e36fb">MV_CC_CreateHandle</a>(deviceList.get(selectNum));</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (handle == <span class="keyword">null</span>) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;CreateHandle fail! nRet&quot;</span>);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga4e982ac1afd05dec95710ac2adcb6c6a">MV_CC_OpenDevice</a>(handle);</div><div class="line">                <span class="keywordflow">if</span> (nRet != 0) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;OpenDevice fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (deviceList.get(selectNum).<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines.MV_GIGE_DEVICE) {</div><div class="line">                    <span class="keywordtype">int</span> nPacketSize = MvCameraControl. <a class="code" href="group___gig_e_xE6_x8E_xA5_xE5_x8F_xA3_xE5_x87_xBD_xE6_x95_xB0.html#ga86ef17ec299b0ff442a063132ced4e6b">MV_CC_GetOptimalPacketSize</a>(handle);</div><div class="line">                    <span class="keywordflow">if</span> (nPacketSize &gt; 0) {</div><div class="line">                        nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga8932770d409766b20cc6819b6d48733f">MV_CC_SetIntValue</a>(handle,<span class="stringliteral">&quot;GevSCPSPacketSize&quot;</span>, nPacketSize);</div><div class="line">                        <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                            showLog(<span class="stringliteral">&quot;Warning: Set Packet Size fail nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">                            <span class="keywordflow">return</span>;</div><div class="line">                        }</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        showLog(<span class="stringliteral">&quot;Warning: Get Packet Size fail nRet&quot;</span> + Integer.toHexString(nPacketSize));</div><div class="line">                    }</div><div class="line">                }</div><div class="line"></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#gac44d08a8835616c96207ab3ed9e8aa6a">MV_CC_SetBoolValue</a>(handle,<span class="stringliteral">&quot;AcquisitionFrameRateEnable&quot;</span>, <span class="keyword">false</span>);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;set AcquisitionFrameRateEnable fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="comment">// 设置触发模式为on</span></div><div class="line">                <span class="comment">// set trigger mode as on</span></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga69d2f77efcabbdf57be21ab9465ee70f">MV_CC_SetEnumValue</a>(handle,<span class="stringliteral">&quot;TriggerMode&quot;</span>, 1);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_SetTriggerMode fail! nRet [%x]&quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="comment">// 设置触发源</span></div><div class="line">                <span class="comment">// set trigger source</span></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga69d2f77efcabbdf57be21ab9465ee70f">MV_CC_SetEnumValue</a>( handle,<span class="stringliteral">&quot;TriggerSource&quot;</span>, MV_TRIGGER_SOURCE_SOFTWARE);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_SetTriggerSource fail! nRet [%x]&quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                Integer width = <span class="keyword">new</span> Integer(0);</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga44cb71a1f783fef852b51c1405560ce1">MV_CC_GetIntValue</a>(handle,<span class="stringliteral">&quot;Width&quot;</span>, width);</div><div class="line">                <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;GetWidth fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                Integer height = <span class="keyword">new</span> Integer(0);</div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga44cb71a1f783fef852b51c1405560ce1">MV_CC_GetIntValue</a>(handle,<span class="stringliteral">&quot;Height&quot;</span>, height);</div><div class="line">                <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;GetHeight fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                datas = <span class="keyword">new</span> <span class="keywordtype">byte</span>[width * height * 3];</div><div class="line"></div><div class="line"></div><div class="line">                <span class="comment">// 开始取流</span></div><div class="line">                <span class="comment">// start grab image</span></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga5ee1c63aac34f3d8ea0ea5c2f5f734f2">MV_CC_StartGrabbing</a>(handle);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_StartGrabbing fail! nRet&quot;</span> + nRet);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">                    @Override</div><div class="line">                    <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                        openDeviceBt.setEnabled(<span class="keyword">false</span>);</div><div class="line">                        closeDeviceBt.setEnabled(<span class="keyword">true</span>);</div><div class="line">                    }</div><div class="line">                });</div><div class="line"></div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                toast(<span class="stringliteral">&quot;Please enumerate the devices first&quot;</span>);</div><div class="line">                <span class="keywordflow">return</span>;</div><div class="line">            }</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">            <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line">                <span class="keywordflow">if</span> (interrupted()) {</div><div class="line">                    <span class="keywordflow">if</span> (iExitGetOneFrame != <span class="keyword">null</span>) {</div><div class="line">                        iExitGetOneFrame.exit();</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line"></div><div class="line">                    <span class="keywordtype">int</span> nRet1 = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga0908fb60cf4b40a560646811629def5a">MV_CC_SetCommandValue</a>(handle,<span class="stringliteral">&quot;TriggerSoftware&quot;</span>);</div><div class="line">                    <span class="keywordflow">if</span> (MV_OK != nRet1) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;failed in TriggerSoftware&quot;</span> + Integer.toHexString(nRet1));</div><div class="line">                    }</div><div class="line"></div><div class="line"></div><div class="line">                    nRet1 = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#gae1a51a885f885902d8783e1237556e48">MV_CC_GetOneFrameTimeout</a>(handle,datas, info, 1000);</div><div class="line">                    <span class="keywordflow">if</span> (nRet1 == MV_OK) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;GetOneFrame, Width:&quot;</span> + info.width +</div><div class="line">                                <span class="stringliteral">&quot;Height:&quot;</span> + info.height +</div><div class="line">                                <span class="stringliteral">&quot;nFrameNum&quot;</span> + info.frameNum);</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        showLog(<span class="stringliteral">&quot;OneFrameTimeout fail：nRet = &quot;</span> + Integer.toHexString(nRet1));</div><div class="line">                        <span class="keywordflow">if</span> (iExitGetOneFrame != <span class="keyword">null</span>) {</div><div class="line">                            iExitGetOneFrame.exit();</div><div class="line">                        }</div><div class="line">                        <span class="keywordflow">return</span>;</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><h1><a class="anchor" id="触发模式下通过回调获取相机图像"></a>
TriggerImageCallActivity.java</h1>
<p>触发模式下通过回调获取相机图像</p>
<p>该示例程序说明了通过软触发回调取图的方式获取图像。创建句柄，打开相机，设置触发模式，设置触发源（软触发），注册抓图回调函数，开始取流，在回调函数中可以获取通过软触发得到的图像信息，停止取流，关闭相机，销毁句柄。 </p><div class="fragment"><div class="line"><span class="keyword">package </span>com.example.triggerimagecallback;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.text.method.ScrollingMovementMethod;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.Button;</div><div class="line"><span class="keyword">import</span> android.widget.EditText;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.CameraManager;</div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.IMainView;</div><div class="line"><span class="keyword">import</span> com.example.hk.basemodule.LogView;</div><div class="line"><span class="keyword">import</span> com.jaredrummler.materialspinner.MaterialSpinner;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.CameraControlException;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.CameraImageCallBack;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControl;</div><div class="line"><span class="keyword">import</span> MvCameraControlWrapper.MvCameraControlDefines;</div><div class="line"></div><div class="line"><span class="keyword">import</span> <span class="keyword">static</span> MvCameraControlWrapper.MvCameraControlDefines.MV_OK;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>TriggerImageCallActivity <span class="keyword">extends</span> AppCompatActivity implements IMainView {</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ArrayList&lt;MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a>&gt; deviceList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    <span class="keyword">private</span> MaterialSpinner spinner;</div><div class="line">    EditText logTv;</div><div class="line">    <span class="keywordtype">int</span> selectNum = 0;</div><div class="line">    Button closeDeviceBt;</div><div class="line">    Button openDeviceBt;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keywordtype">int</span> MV_TRIGGER_SOURCE_SOFTWARE = 7;</div><div class="line">    GetOneFrameThread getOneFrameThread;</div><div class="line">    OpenDeviceThread openDeviceThread;</div><div class="line">    <span class="keywordtype">boolean</span> g_bIsGetImage = <span class="keyword">true</span>;</div><div class="line">    MvCameraControlDefines.Handle handle = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onCreate(Bundle savedInstanceState) {</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_trigger_image_call);</div><div class="line">        initView();</div><div class="line">        initListener();</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initView() {</div><div class="line">        spinner = findViewById(R.id.spinner);</div><div class="line">        logTv = findViewById(R.id.logTv);</div><div class="line">        logTv.setMovementMethod(ScrollingMovementMethod.getInstance());</div><div class="line">        openDeviceBt = findViewById(R.id.openDeviceBt);</div><div class="line">        closeDeviceBt = findViewById(R.id.closeDeviceBt);</div><div class="line">        spinner.setOnItemSelectedListener(<span class="keyword">new</span> MaterialSpinner.OnItemSelectedListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onItemSelected(MaterialSpinner view, <span class="keywordtype">int</span> position, <span class="keywordtype">long</span> <span class="keywordtype">id</span>, Object item) {</div><div class="line">                selectNum = position;</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> initListener() {</div><div class="line">        findViewById(R.id.enumDevicesBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                selectNum = 0;</div><div class="line">                deviceList.clear();</div><div class="line">                spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    deviceList = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga2e162b1972c75982ff1c52e1c5d34a4e">MV_CC_EnumDevices</a>(MvCameraControlDefines.MV_USB_DEVICE | MvCameraControlDefines.MV_GIGE_DEVICE);</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (deviceList != <span class="keyword">null</span>) {</div><div class="line">                    <span class="keywordtype">int</span> size = deviceList.size();</div><div class="line">                    <span class="keywordflow">if</span> (size &gt; 0) {</div><div class="line">                        List&lt;String&gt; deviceName = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">                        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size; i++) {</div><div class="line">                            MvCameraControlDefines. <a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html">MV_CC_DEVICE_INFO</a> entity = deviceList.get(i);</div><div class="line">                            <span class="keywordflow">if</span> (entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines.MV_GIGE_DEVICE) {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a9e8dbdf67802699038b0421c0d311499">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a727f4f765547596fdca29f86a2406dc9">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#a0a3a766f998932a02e10e0223b05801c">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#a95fb496433fc5be9ef0325aaad50f9e9">gigEInfo</a>.<a class="code" href="class_m_v___g_i_g_e___d_e_v_i_c_e___i_n_f_o.html#ac0d8c9621aa38cb936f906d981c6a31b">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            } <span class="keywordflow">else</span> {</div><div class="line">                                String str = <span class="stringliteral">&quot;[&quot;</span> + String.valueOf(i) + <span class="stringliteral">&quot;]&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#ac568233b448c639976fe3280fcc2d0d5">manufacturerName</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aeecafd7f0254f5bad432f2323b202700">serialNumber</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#a6b9a01f50a786e68ab65f3ba33079d26">deviceVersion</a> + <span class="stringliteral">&quot;--&quot;</span></div><div class="line">                                        + entity.<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aba240a4857195fcd22b91a76d2f6fb12">usb3VInfo</a>.<a class="code" href="class_m_v___u_s_b3___d_e_v_i_c_e___i_n_f_o.html#aac5ebaab488a72e9a7dcb2a5818e33bc">userDefinedName</a>;</div><div class="line">                                deviceName.add(str);</div><div class="line">                            }</div><div class="line"></div><div class="line">                        }</div><div class="line">                        spinner.setItems(deviceName);</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        spinner.setItems(<span class="keyword">new</span> ArrayList());</div><div class="line">                    }</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    showLog(<span class="stringliteral">&quot;Not enumerated to device&quot;</span>);</div><div class="line">                }</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        findViewById(R.id.openDeviceBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                openDevice();</div><div class="line">            }</div><div class="line">        });</div><div class="line"></div><div class="line">        findViewById(R.id.closeDeviceBt).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> onClick(View v) {</div><div class="line">                closeDevice();</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> showLog(<span class="keyword">final</span> String str) {</div><div class="line">        LogView.showLog(<span class="keyword">this</span>, logTv, str);</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateButton(<span class="keywordtype">int</span> state) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> updateImage(<span class="keywordtype">byte</span>[] data) {</div><div class="line"></div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> toast(<span class="keyword">final</span> String <span class="keywordtype">string</span>) {</div><div class="line">        runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">            @Override</div><div class="line">            <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                Toast.makeText(TriggerImageCallActivity.this, <span class="keywordtype">string</span>, Toast.LENGTH_SHORT).show();</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> openDevice() {</div><div class="line">        <span class="keywordflow">if</span> (openDeviceThread == <span class="keyword">null</span>) {</div><div class="line">            openDeviceThread = <span class="keyword">new</span> OpenDeviceThread();</div><div class="line">            openDeviceThread.start();</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">            <span class="keywordflow">if</span> (!openDeviceThread.isAlive()) {</div><div class="line">                openDeviceThread.start();</div><div class="line">            }<span class="keywordflow">else</span> {</div><div class="line">                showLog(<span class="stringliteral">&quot;Please try later&quot;</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">void</span> closeDevice() {</div><div class="line">        <span class="comment">// 停止取流</span></div><div class="line">        <span class="keywordflow">if</span> (getOneFrameThread != <span class="keyword">null</span>) {</div><div class="line">            getOneFrameThread.falg = <span class="keyword">false</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    @Override</div><div class="line">    <span class="keyword">protected</span> <span class="keywordtype">void</span> onDestroy() {</div><div class="line">        super.onDestroy();</div><div class="line">        <span class="keywordflow">if</span> (closeDeviceBt.isEnabled()) {</div><div class="line">            closeDevice();</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">class </span>GetOneFrameThread <span class="keyword">extends</span> Thread {</div><div class="line">        <span class="keywordtype">boolean</span> falg = <span class="keyword">true</span>;</div><div class="line">        IExitGetOneFrame iExitGetOneFrame;</div><div class="line"></div><div class="line">        <span class="keyword">public</span> GetOneFrameThread(IExitGetOneFrame iExitGetOneFrame) {</div><div class="line">            this.iExitGetOneFrame = iExitGetOneFrame;</div><div class="line">        }</div><div class="line"></div><div class="line">        @Override</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">            super.run();</div><div class="line">            <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div><div class="line">                <span class="keywordflow">if</span> (!falg) {</div><div class="line">                    <span class="keywordflow">if</span> (iExitGetOneFrame != <span class="keyword">null</span>) {</div><div class="line">                        iExitGetOneFrame.exit();</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line"></div><div class="line">                    <span class="keywordtype">int</span> nRet1 = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga0908fb60cf4b40a560646811629def5a">MV_CC_SetCommandValue</a>(handle,<span class="stringliteral">&quot;TriggerSoftware&quot;</span>);</div><div class="line">                    <span class="keywordflow">if</span> (MV_OK != nRet1) {</div><div class="line">                        showLog(<span class="stringliteral">&quot;failed in TriggerSoftware&quot;</span> + Integer.toHexString(nRet1));</div><div class="line">                    }</div><div class="line">                    <span class="keywordflow">try</span> {</div><div class="line">                        Thread.sleep(1000);</div><div class="line">                    } <span class="keywordflow">catch</span> (InterruptedException e) {</div><div class="line">                        e.printStackTrace();</div><div class="line">                    }</div><div class="line">                }</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keyword">class </span>OpenDeviceThread <span class="keyword">extends</span> Thread {</div><div class="line">        @Override</div><div class="line">        <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">            super.run();</div><div class="line">            <span class="keywordflow">if</span> (deviceList != <span class="keyword">null</span> &amp;&amp; deviceList.size() &gt; 0) {</div><div class="line"></div><div class="line">                <span class="keywordflow">try</span> {</div><div class="line">                    handle = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#gae94fdee0967a330a197b783c781e36fb">MV_CC_CreateHandle</a>(deviceList.get(selectNum));</div><div class="line">                } <span class="keywordflow">catch</span> (CameraControlException e) {</div><div class="line">                    e.printStackTrace();</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (handle == <span class="keyword">null</span>) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;CreateHandle fail! nRet&quot;</span>);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordtype">int</span> nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga4e982ac1afd05dec95710ac2adcb6c6a">MV_CC_OpenDevice</a>(handle);</div><div class="line">                <span class="keywordflow">if</span> (nRet != 0) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;OpenDevice fail! nRet &quot;</span> + Integer.toHexString(nRet));</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">if</span> (deviceList.get(selectNum).<a class="code" href="class_m_v___c_c___d_e_v_i_c_e___i_n_f_o.html#aa71ee7ba15027f3b970fe6c5e31cfd3b">transportLayerType</a> == MvCameraControlDefines.MV_GIGE_DEVICE) {</div><div class="line">                    <span class="keywordtype">int</span> nPacketSize = MvCameraControl. <a class="code" href="group___gig_e_xE6_x8E_xA5_xE5_x8F_xA3_xE5_x87_xBD_xE6_x95_xB0.html#ga86ef17ec299b0ff442a063132ced4e6b">MV_CC_GetOptimalPacketSize</a>(handle);</div><div class="line">                    <span class="keywordflow">if</span> (nPacketSize &gt; 0) {</div><div class="line">                        nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga8932770d409766b20cc6819b6d48733f">MV_CC_SetIntValue</a>(handle,<span class="stringliteral">&quot;GevSCPSPacketSize&quot;</span>, nPacketSize);</div><div class="line">                        <span class="keywordflow">if</span> (nRet != MV_OK) {</div><div class="line">                            showLog(<span class="stringliteral">&quot;Warning: Set Packet Size fail nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">                            <span class="keywordflow">return</span>;</div><div class="line">                        }</div><div class="line">                    } <span class="keywordflow">else</span> {</div><div class="line">                        showLog(<span class="stringliteral">&quot;Warning: Get Packet Size fail nRet&quot;</span> + Integer.toHexString(nPacketSize));</div><div class="line">                    }</div><div class="line">                }</div><div class="line"></div><div class="line"></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#gac44d08a8835616c96207ab3ed9e8aa6a">MV_CC_SetBoolValue</a>(handle,<span class="stringliteral">&quot;AcquisitionFrameRateEnable&quot;</span>, <span class="keyword">false</span>);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;set AcquisitionFrameRateEnable fail! nRet &quot;</span> + nRet);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="comment">// 设置触发模式为on</span></div><div class="line">                <span class="comment">// set trigger mode as on</span></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga69d2f77efcabbdf57be21ab9465ee70f">MV_CC_SetEnumValue</a>(handle,<span class="stringliteral">&quot;TriggerMode&quot;</span>, 1);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_SetTriggerMode fail! nRet&quot;</span> + nRet);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="comment">// 设置触发源</span></div><div class="line">                <span class="comment">// set trigger source</span></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x8F_x82_xE6_x95_xB0_xE9_x80_x9A_xE7_x94_xA8_xE9_x85_x8D_xE7_xBD_xAE_xE6_x8E_xA5_xE5_x8F_xA3.html#ga69d2f77efcabbdf57be21ab9465ee70f">MV_CC_SetEnumValue</a>(handle,<span class="stringliteral">&quot;TriggerSource&quot;</span>, MV_TRIGGER_SOURCE_SOFTWARE);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_SetTriggerSource fail! nRet &quot;</span> + nRet);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line"></div><div class="line">                <span class="comment">// 注册抓图回调</span></div><div class="line">                <span class="comment">// register image callback</span></div><div class="line">                nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga52ef975ad47c0ad8ea71480c64e71d80">MV_CC_RegisterImageCallBack</a>(handle,<span class="keyword">new</span> <a class="code" href="group___xE5_x9B_x9E_xE8_xB0_x83_xE5_x87_xBD_xE6_x95_xB0.html#gad8559ccfcfe48b541d40b440a63ef641">CameraImageCallBack</a>() {</div><div class="line">                    @Override</div><div class="line">                    <span class="keyword">public</span> <span class="keywordtype">int</span> OnImageCallBack(<span class="keywordtype">byte</span>[] bytes, <span class="keyword">final</span> MvCameraControlDefines.MV_FRAME_OUT_INFO mv_frame_out_info) {</div><div class="line">                        runOnUiThread(<span class="keyword">new</span> Runnable() {</div><div class="line">                            @Override</div><div class="line">                            <span class="keyword">public</span> <span class="keywordtype">void</span> run() {</div><div class="line">                                showLog(<span class="stringliteral">&quot;GetOneFrame, Width:&quot;</span> + mv_frame_out_info.width +</div><div class="line">                                        <span class="stringliteral">&quot;Height:&quot;</span> + mv_frame_out_info.height +</div><div class="line">                                        <span class="stringliteral">&quot;nFrameNum&quot;</span> + mv_frame_out_info.frameNum);</div><div class="line">                                <span class="comment">// g_bIsGetImage = true;</span></div><div class="line">                            }</div><div class="line">                        });</div><div class="line"></div><div class="line">                        <span class="keywordflow">return</span> 0;</div><div class="line">                    }</div><div class="line">                });</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_RegisterImageCallBackEx fail! nRet&quot;</span> + nRet);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line">                <span class="comment">// 开始取流</span></div><div class="line">                <span class="comment">// start grab image</span></div><div class="line">                nRet =MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga5ee1c63aac34f3d8ea0ea5c2f5f734f2">MV_CC_StartGrabbing</a>(handle);</div><div class="line">                <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                    showLog(<span class="stringliteral">&quot;MV_CC_StartGrabbing fail! nRet&quot;</span> + nRet);</div><div class="line">                    <span class="keywordflow">return</span>;</div><div class="line">                }</div><div class="line"></div><div class="line"></div><div class="line">                <span class="keywordflow">if</span> (getOneFrameThread == <span class="keyword">null</span>) {</div><div class="line">                    getOneFrameThread = <span class="keyword">new</span> GetOneFrameThread(<span class="keyword">new</span> IExitGetOneFrame() {</div><div class="line">                        @Override</div><div class="line">                        <span class="keyword">public</span> <span class="keywordtype">void</span> exit() {</div><div class="line">                            <span class="comment">// 停止取流</span></div><div class="line">                            <span class="comment">// end grab image</span></div><div class="line">                            <span class="keywordtype">int</span> nRet = MvCameraControl. <a class="code" href="group___xE5_x9B_xBE_xE5_x83_x8F_xE9_x87_x87_xE9_x9B_x86.html#ga951784eace474e8a5049c911966c381f">MV_CC_StopGrabbing</a>(handle);</div><div class="line">                            <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                                showLog(<span class="stringliteral">&quot;MV_CC_StopGrabbing fail! nRet&quot;</span> + Integer.toHexString(nRet));</div><div class="line">                            }</div><div class="line">                            <span class="comment">// 关闭设备</span></div><div class="line">                            <span class="comment">// close device</span></div><div class="line">                            nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga9200ad9b866b2fc9b8cae94fbba56fde">MV_CC_CloseDevice</a>(handle);</div><div class="line">                            <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                                showLog(<span class="stringliteral">&quot;MV_CC_CloseDevice fail! nRet &quot;</span> + nRet);</div><div class="line">                            }</div><div class="line">                            <span class="comment">// 销毁句柄</span></div><div class="line">                            <span class="comment">// destroy handle</span></div><div class="line">                            nRet = MvCameraControl. <a class="code" href="group___xE7_x9B_xB8_xE6_x9C_xBA_xE5_x88_x9D_xE5_xA7_x8B_xE5_x8C_x96_xE5_x8F_x8A_xE9_x94_x80_xE6_xAF_x81.html#ga8385105a0abb3a23dc2728ce980656ba">MV_CC_DestroyHandle</a>(handle);</div><div class="line">                            <span class="keywordflow">if</span> (MV_OK != nRet) {</div><div class="line">                                showLog(<span class="stringliteral">&quot;MV_CC_DestroyHandle fail! nRet&quot;</span> + nRet);</div><div class="line">                            }</div><div class="line">                        }</div><div class="line">                    });</div><div class="line">                    getOneFrameThread.falg = <span class="keyword">true</span>;</div><div class="line">                    getOneFrameThread.start();</div><div class="line"></div><div class="line">                } <span class="keywordflow">else</span> {</div><div class="line">                    getOneFrameThread.falg = <span class="keyword">true</span>;</div><div class="line">                    getOneFrameThread.start();</div><div class="line">                }</div><div class="line">                g_bIsGetImage = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">            } <span class="keywordflow">else</span> {</div><div class="line">                toast(<span class="stringliteral">&quot;Please enumerate the devices first&quot;</span>);</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line"></div><div class="line">}</div></div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<div class="footer" style="text-align: right;">
	<hr/>
	<small></small>
</div>
</body>
</html>